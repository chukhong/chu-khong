"undefined"!=typeof process&&require("amd-loader");var EditSession=require("./edit_session").EditSession,MockRenderer=require("./test/mockrenderer").MockRenderer,Editor=require("./editor").Editor,Search=require("./search").Search,assert=require("./test/assertions");module.exports={"test: configure the search object":function(){(new Search).set({needle:"juhu"})},"test: find simple text in document":function(){var e=new EditSession(["juhu kinners 123","456"]),e=(new Search).set({needle:"kinners"}).find(e);assert.position(e.start,0,5),assert.position(e.end,0,12)},"test: find simple text in next line":function(){var e=new EditSession(["abc","juhu kinners 123","456"]),e=(new Search).set({needle:"kinners"}).find(e);assert.position(e.start,1,5),assert.position(e.end,1,12)},"test: find text starting at cursor position":function(){var e=new EditSession(["juhu kinners","juhu kinners 123"]);e.getSelection().moveCursorTo(0,6);e=(new Search).set({needle:"kinners"}).find(e);assert.position(e.start,1,5),assert.position(e.end,1,12)},"test: wrap search is on by default":function(){var e=new EditSession(["abc","juhu kinners 123","456"]),t=(e.getSelection().moveCursorTo(2,1),(new Search).set({needle:"kinners"}));assert.notEqual(t.find(e),null)},"test: wrap search should wrap at file end":function(){var e=new EditSession(["abc","juhu kinners 123","456"]);e.getSelection().moveCursorTo(2,1);e=(new Search).set({needle:"kinners",wrap:!0}).find(e);assert.position(e.start,1,5),assert.position(e.end,1,12)},"test: wrap search should find needle even if it starts inside it":function(){var e=new EditSession(["abc","juhu kinners 123","456"]);e.getSelection().moveCursorTo(6,1);e=(new Search).set({needle:"kinners",wrap:!0}).find(e);assert.position(e.start,1,5),assert.position(e.end,1,12)},"test: wrap search with no match should return 'null'":function(){var e=new EditSession(["abc","juhu kinners 123","456"]),t=(e.getSelection().moveCursorTo(2,1),(new Search).set({needle:"xyz",wrap:!0}));assert.equal(t.find(e),null)},"test: case sensitive is by default off":function(){var e=new EditSession(["abc","juhu kinners 123","456"]),t=(new Search).set({needle:"JUHU"});assert.range(t.find(e),1,0,1,4)},"test: case sensitive search":function(){var e=new EditSession(["abc","juhu kinners 123","456"]),e=(new Search).set({needle:"KINNERS",caseSensitive:!0}).find(e);assert.equal(e,null)},"test: whole word search should not match inside of words":function(){var e=new EditSession(["juhukinners","juhu kinners 123","456"]),e=(new Search).set({needle:"kinners",wholeWord:!0}).find(e);assert.position(e.start,1,5),assert.position(e.end,1,12)},"test: find backwards":function(){var e=new EditSession(["juhu juhu juhu juhu"]);e.getSelection().moveCursorTo(0,10);e=(new Search).set({needle:"juhu",backwards:!0}).find(e);assert.position(e.start,0,5),assert.position(e.end,0,9)},"test: find in selection":function(){var e=new EditSession(["juhu","juhu","juhu","juhu"]),t=(e.getSelection().setSelectionAnchor(1,0),e.getSelection().selectTo(3,5),(new Search).set({needle:"juhu",wrap:!0,range:e.getSelection().getRange()})),n=t.find(e),n=(assert.position(n.start,1,0),assert.position(n.end,1,4),t=(new Search).set({needle:"juhu",wrap:!0,range:e.getSelection().getRange()}),e.getSelection().setSelectionAnchor(0,2),e.getSelection().selectTo(3,2),t.find(e));assert.position(n.start,1,0),assert.position(n.end,1,4)},"test: find backwards in selection":function(){var e=new EditSession(["juhu","juhu","juhu","juhu"]),t=(e.getSelection().setSelectionAnchor(0,2),e.getSelection().selectTo(3,2),(new Search).set({needle:"juhu",wrap:!0,backwards:!0,range:e.getSelection().getRange()})),n=t.find(e),n=(assert.position(n.start,2,0),assert.position(n.end,2,4),t=(new Search).set({needle:"juhu",wrap:!0,range:e.getSelection().getRange()}),e.getSelection().setSelectionAnchor(0,2),e.getSelection().selectTo(1,2),t.find(e));assert.position(n.start,1,0),assert.position(n.end,1,4)},"test: edge case - match directly before the cursor":function(){var e=new EditSession(["123","123","juhu"]),t=(new Search).set({needle:"juhu",wrap:!0}),t=(e.getSelection().moveCursorTo(2,5),t.find(e));assert.position(t.start,2,0),assert.position(t.end,2,4)},"test: edge case - match backwards directly after the cursor":function(){var e=new EditSession(["123","123","juhu"]),t=(new Search).set({needle:"juhu",wrap:!0,backwards:!0}),t=(e.getSelection().moveCursorTo(2,0),t.find(e));assert.position(t.start,2,0),assert.position(t.end,2,4)},"test: find using a regular expression":function(){var e=new EditSession(["abc123 123 cd","abc"]),e=(new Search).set({needle:"\\d+",regExp:!0}).find(e);assert.position(e.start,0,3),assert.position(e.end,0,6)},"test: find using a regular expression and whole word":function(){var e=new EditSession(["abc123 123 cd","abc"]),e=(new Search).set({needle:"\\d+\\b",regExp:!0,wholeWord:!0}).find(e);assert.position(e.start,0,7),assert.position(e.end,0,10)},"test: use regular expressions with capture groups":function(){var e=new EditSession(["  ab: 12px","  <h1 abc"]),e=(new Search).set({needle:"(\\d+)",regExp:!0}).find(e);assert.position(e.start,0,6),assert.position(e.end,0,8)},"test: find all matches in selection":function(){var e=new EditSession(["juhu","juhu","juhu","juhu"]);e.getSelection().setSelectionAnchor(0,2),e.getSelection().selectTo(3,2);e=(new Search).set({needle:"uh",wrap:!0,range:e.getSelection().getRange()}).findAll(e);assert.equal(e.length,2),assert.position(e[0].start,1,1),assert.position(e[0].end,1,3),assert.position(e[1].start,2,1),assert.position(e[1].end,2,3)},"test: find all multiline matches":function(){var e=new EditSession(["juhu","juhu","juhu","juhu"]),e=(new Search).set({needle:"hu\nju",wrap:!0}).findAll(e);assert.equal(e.length,3),assert.position(e[0].start,0,2),assert.position(e[0].end,1,2),assert.position(e[1].start,1,2),assert.position(e[1].end,2,2)},"test: replace() should return the replacement if the input matches the needle":function(){var e=(new Search).set({needle:"juhu"});assert.equal(e.replace("juhu","kinners"),"kinners"),assert.equal(e.replace("","kinners"),null),assert.equal(e.replace(" juhu","kinners"),null),assert.equal(e.replace("Juhu","kinners"),"kinners"),e.set({caseSensitive:!0}),assert.equal(e.replace("Juhu","kinners"),null)},"test: replace with a RegExp search":function(){var e=(new Search).set({needle:"\\d+",regExp:!0});assert.equal(e.replace("123","kinners"),"kinners"),assert.equal(e.replace("01234","kinners"),"kinners"),assert.equal(e.replace("","kinners"),null),assert.equal(e.replace("a12","kinners"),null),assert.equal(e.replace("12a","kinners"),null)},"test: replace with RegExp match and capture groups":function(){var e=(new Search).set({needle:"ab(\\d\\d)",regExp:!0});assert.equal(e.replace("ab12","cd$1"),"cd12"),assert.equal(e.replace("ab12","-$&-"),"-ab12-"),assert.equal(e.replace("ab12","$$"),"$")},"test: find all using regular expresion containing $":function(){var e=new EditSession(["a","     b","c ","d"]),t=(new Search).set({needle:"[ ]+$",regExp:!0,wrap:!0}),t=(e.getSelection().moveCursorTo(1,2),t.findAll(e));assert.equal(t.length,1),assert.position(t[0].start,2,1),assert.position(t[0].end,2,2)},"test: find all matches in a line":function(){var e=new EditSession("foo bar foo baz foobar foo"),t=(new Search).set({needle:"foo",wrap:!0,wholeWord:!0}),t=(e.getSelection().moveCursorTo(0,4),t.findAll(e));assert.equal(t.length,3),assert.position(t[0].start,0,0),assert.position(t[0].end,0,3),assert.position(t[1].start,0,8),assert.position(t[1].end,0,11),assert.position(t[2].start,0,23),assert.position(t[2].end,0,26)},"test: find all matches in a line backwards":function(){var e=new EditSession("foo bar foo baz foobar foo"),t=(new Search).set({needle:"foo",wrap:!0,wholeWord:!0,backwards:!0}),t=(e.getSelection().moveCursorTo(0,13),t.findAll(e));assert.equal(t.length,3),assert.position(t[2].start,0,23),assert.position(t[2].end,0,26),assert.position(t[1].start,0,8),assert.position(t[1].end,0,11),assert.position(t[0].start,0,0),assert.position(t[0].end,0,3)},"test: find next empty range":function(){var e=new EditSession("foo foobar foo"),t=new Editor(new MockRenderer,e),n={needle:"o*",wrap:!0,regExp:!0,backwards:!1},s=[4,5.2,7,8,9,10,11,12.2,14,0,1.2,3];e.selection.moveCursorTo(0,3);for(var r=0;r<s.length;r++){t.find(n);var i=(o=t.selection.getRange()).start.column,a=o.end.column-i;assert.equal(i+.1*a,s[r])}n.backwards=!0;for(s=[1.2,0,12.2,11,10,9,8,7,5.2,4,3,1.2,0],r=0;r<s.length;r++){t.find(n);var o,i=(o=t.selection.getRange()).start.column,a=o.end.column-i;assert.equal(i+.1*a,s[r])}},"test: repeating text":function(){var e=new EditSession("tttttt\ntttttt\ntttttt\ntttttt\ntttttt\ntttttt"),i=new Editor(new MockRenderer,e),a={needle:"^",wrap:!0,regExp:!0,backwards:!1};function t(e,t,n,s){i.find(a);var r=i.selection.getRange();assert.range(r,e,t,n,s)}e.selection.moveCursorTo(1,3),t(2,0,2,0),a.needle="tttt\ntttt",t(2,2,3,4),t(4,2,5,4),t(0,2,1,4),a.backwards=!0,t(4,2,5,4),t(2,2,3,4),t(0,2,1,4),t(4,2,5,4)}},"undefined"!=typeof module&&module===require.main&&require("asyncjs").test.testcase(module.exports).exec();