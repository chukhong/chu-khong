"use strict";var lang=require("./lib/lang"),oop=require("./lib/oop"),Range=require("./range").Range,SearchHighlight=function(e,t,i){this.setRegexp(e),this.clazz=t,this.type=i||"text"};!function(){this.MAX_RANGES=500,this.setRegexp=function(e){this.regExp+""!=e+""&&(this.regExp=e,this.cache=[])},this.update=function(e,t,i,h){if(this.regExp)for(var r=h.firstRow,g=h.lastRow,n={},a=r;a<=g;a++){var s=this.cache[a];null==s&&(s=(s=(s=lang.getMatchOffsets(i.getLine(a),this.regExp)).length>this.MAX_RANGES?s.slice(0,this.MAX_RANGES):s).map(function(e){return new Range(a,e.offset,a,e.offset+e.length)}),this.cache[a]=s.length?s:"");for(var c=s.length;c--;){var l=s[c].toScreenRange(i),o=l.toString();n[o]||(n[o]=!0,t.drawSingleLineMarker(e,l,this.clazz,h))}}}}.call(SearchHighlight.prototype),exports.SearchHighlight=SearchHighlight;