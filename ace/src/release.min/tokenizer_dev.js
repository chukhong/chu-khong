var BaseTokenizer=require("./tokenizer").Tokenizer,MAX_TOKEN_COUNT=2e3,Tokenizer=function(e){BaseTokenizer.call(this,e),this.getLineTokens=function(e,t){t&&"string"!=typeof t?t=(n=t.slice(0))[0]:n=[];var n,s,r=t||"start",i=this.states[r],o=this.matchMappings[r],a=this.regExps[r],l=[],p=a.lastIndex=0,h=[];function u(){h.push(t+"@"+p)}for(var f={type:null,value:"",state:r},g=(u(),h=[],u(),2e4);s=a.exec(e);){var k,y=o.defaultToken,c=null,T=s[0],v=a.lastIndex;v-T.length>p&&(k=e.substring(p,v-T.length),f.type==y?f.value+=k:(f.type&&l.push(f),f={type:y,value:k}));for(var x=0;x<s.length-2;x++)if(void 0!==s[x+1]){if(!g--)throw"infinite"+i[o[x]]+r;y=(c=i[o[x]]).onMatch?c.onMatch(T,r,n,e):c.token,c.next&&(r="string"==typeof c.next?c.next:c.next(r,n),(i=this.states[r])||(window.console&&console.error&&console.error(r,"doesn't exist"),i=this.states[r="start"]),o=this.matchMappings[r],p=v,(a=this.regExps[r]).lastIndex=v,u()),c.consumeLineEnd&&(p=v);break}if(T)if("string"==typeof y)c&&!1===c.merge||f.type!==y?(f.type&&l.push(f),f={type:y,value:T}):f.value+=T;else{f.type&&l.push(f);for(f={type:null,value:""},x=0;x<y.length;x++)l.push(y[x])}if(p==e.length)break;if(p=v,MAX_TOKEN_COUNT<l.length){f.value+=e.substr(p),r="start";break}}return f.type&&l.push(f),{tokens:l,state:n.length?n:r}}};Tokenizer.prototype=BaseTokenizer.prototype,exports.Tokenizer=Tokenizer;