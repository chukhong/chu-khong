"use strict";var oop=require("./lib/oop"),Range=require("./range").Range,Search=require("./search").Search,EditSession=require("./edit_session").EditSession,SearchHighlight=require("./search_highlight").SearchHighlight;function Occur(){}oop.inherits(Occur,Search),function(){this.enter=function(i,n){var r;return!!n.needle&&(r=i.getCursorPosition(),this.displayOccurContent(i,n),n=this.originalToOccurPosition(i.session,r),i.moveCursorToPosition(n),!0)},this.exit=function(i,n){n=n.translatePosition&&i.getCursorPosition(),n=n&&this.occurToOriginalPosition(i.session,n);return this.displayOriginalContent(i),n&&i.moveCursorToPosition(n),!0},this.highlight=function(i,n){(i.$occurHighlight=i.$occurHighlight||i.addDynamicMarker(new SearchHighlight(null,"ace_occur-highlight","text"))).setRegexp(n),i._emit("changeBackMarker")},this.displayOccurContent=function(i,n){this.$originalSession=i.session;var r=this.matchingLines(i.session,n),t=r.map(function(i){return i.content}),t=new EditSession(t.join("\n"));t.$occur=this,t.$occurMatchingLines=r,i.setSession(t),this.$useEmacsStyleLineStart=this.$originalSession.$useEmacsStyleLineStart,t.$useEmacsStyleLineStart=this.$useEmacsStyleLineStart,this.highlight(t,n.re),t._emit("changeBackMarker")},this.displayOriginalContent=function(i){i.setSession(this.$originalSession),this.$originalSession.$useEmacsStyleLineStart=this.$useEmacsStyleLineStart},this.originalToOccurPosition=function(i,n){var r=i.$occurMatchingLines,i={row:0,column:0};if(r)for(var t=0;t<r.length;t++)if(r[t].row===n.row)return{row:t,column:n.column};return i},this.occurToOriginalPosition=function(i,n){i=i.$occurMatchingLines;return i&&i[n.row]?{row:i[n.row].row,column:n.column}:n},this.matchingLines=function(t,i){var n;return i=oop.mixin({},i),t&&i.needle?((n=new Search).set(i),n.findAll(t).reduce(function(i,n){var n=n.start.row,r=i[i.length-1];return r&&r.row===n?i:i.concat({row:n,content:t.getLine(n)})},[])):[]}}.call(Occur.prototype);var dom=require("./lib/dom");dom.importCssString(".ace_occur-highlight {\n    border-radius: 4px;\n    background-color: rgba(87, 255, 8, 0.25);\n    position: absolute;\n    z-index: 4;\n    box-sizing: border-box;\n    box-shadow: 0 0 4px rgb(91, 255, 50);\n}\n.ace_dark .ace_occur-highlight {\n    background-color: rgb(80, 140, 85);\n    box-shadow: 0 0 4px rgb(60, 120, 70);\n}\n","incremental-occur-highlighting",!1),exports.Occur=Occur;