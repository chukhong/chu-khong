"use strict";var commands=[{name:"leftToRight",bindKey:{win:"Ctrl-Alt-Shift-L",mac:"Command-Alt-Shift-L"},exec:function(e){e.session.$bidiHandler.setRtlDirection(e,!1)},readOnly:!0},{name:"rightToLeft",bindKey:{win:"Ctrl-Alt-Shift-R",mac:"Command-Alt-Shift-R"},exec:function(e){e.session.$bidiHandler.setRtlDirection(e,!0)},readOnly:!0}],Editor=require("../editor").Editor;function onChangeSelection(e,n){var i=n.getSelection().lead;n.session.$bidiHandler.isRtlLine(i.row)&&0===i.column&&(n.session.$bidiHandler.isMoveLeftOperation&&0<i.row?n.getSelection().moveCursorTo(i.row-1,n.session.getLine(i.row-1).length):n.getSelection().isEmpty()?i.column+=1:i.setPosition(i.row,i.column+1))}function onCommandEmitted(e){e.editor.session.$bidiHandler.isMoveLeftOperation=/gotoleft|selectleft|backspace|removewordleft/.test(e.command.name)}function onChange(e,n){var i=n.session;if(i.$bidiHandler.currentRow=null,i.$bidiHandler.isRtlLine(e.start.row)&&"insert"===e.action&&1<e.lines.length)for(var t=e.start.row;t<e.end.row;t++)i.getLine(t+1).charAt(0)!==i.$bidiHandler.RLE&&(i.doc.$lines[t+1]=i.$bidiHandler.RLE+i.getLine(t+1))}function updateLineDirection(e,n){var i=n.session.$bidiHandler,t=n.$textLayer.$lines.cells,o=n.layerConfig.width-n.layerConfig.padding+"px";t.forEach(function(e){var n=e.element.style;i&&i.isRtlLine(e.row)?(n.direction="rtl",n.textAlign="right",n.width=o):(n.direction="",n.textAlign="",n.width="")})}function clearTextLayer(e){e=e.$textLayer.$lines;function n(e){e=e.element.style;e.direction=e.textAlign=e.width=""}e.cells.forEach(n),e.cellCache.forEach(n)}require("../config").defineOptions(Editor.prototype,"editor",{rtlText:{set:function(e){e?(this.on("change",onChange),this.on("changeSelection",onChangeSelection),this.renderer.on("afterRender",updateLineDirection),this.commands.on("exec",onCommandEmitted),this.commands.addCommands(commands)):(this.off("change",onChange),this.off("changeSelection",onChangeSelection),this.renderer.off("afterRender",updateLineDirection),this.commands.off("exec",onCommandEmitted),this.commands.removeCommands(commands),clearTextLayer(this.renderer)),this.renderer.updateFull()}},rtl:{set:function(e){(this.session.$bidiHandler.$isRtl=e)?(this.setOption("rtlText",!1),this.renderer.on("afterRender",updateLineDirection),this.session.$bidiHandler.seenBidi=!0):(this.renderer.off("afterRender",updateLineDirection),clearTextLayer(this.renderer)),this.renderer.updateFull()}}});