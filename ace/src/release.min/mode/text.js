"use strict";var config=require("../config"),Tokenizer=require("../tokenizer").Tokenizer,TextHighlightRules=require("./text_highlight_rules").TextHighlightRules,CstyleBehaviour=require("./behaviour/cstyle").CstyleBehaviour,unicode=require("../unicode"),lang=require("../lib/lang"),TokenIterator=require("../token_iterator").TokenIterator,Range=require("../range").Range,Mode=function(){this.HighlightRules=TextHighlightRules};!function(){this.$defaultBehaviour=new CstyleBehaviour,this.tokenRe=new RegExp("^["+unicode.wordChars+"\\$_]+","g"),this.nonTokenRe=new RegExp("^(?:[^"+unicode.wordChars+"\\$_]|\\s])+","g"),this.getTokenizer=function(){return this.$tokenizer||(this.$highlightRules=this.$highlightRules||new this.HighlightRules(this.$highlightRuleConfig),this.$tokenizer=new Tokenizer(this.$highlightRules.getRules())),this.$tokenizer},this.lineCommentStart="",this.blockComment="",this.toggleCommentLines=function(e,i,n,r){var o=i.doc,s=!0,h=!0,a=1/0,l=i.getTabSize(),t=!1;if(this.lineCommentStart){d=Array.isArray(this.lineCommentStart)?(p=this.lineCommentStart.map(lang.escapeRegExp).join("|"),this.lineCommentStart[0]):(p=lang.escapeRegExp(this.lineCommentStart),this.lineCommentStart),p=new RegExp("^(\\s*)(?:"+p+") ?"),t=i.getUseSoftTabs();var u=function(e,t){var n,r,i=e.match(p);i&&(n=i[1].length,r=i[0].length,f(e,n,r)||" "!=i[0][r-1]||r--,o.removeInLine(t,n,r))},g=d+" ",c=function(e,t){s&&!/\S/.test(e)||(f(e,a,a)?o.insertInLine({row:t,column:a},g):o.insertInLine({row:t,column:a},d))},m=function(e,t){return p.test(e)},f=function(e,t,n){for(var r=0;t--&&" "==e.charAt(t);)r++;if(r%l!=0)return!1;for(r=0;" "==e.charAt(n++);)r++;return 2<l?r%l!=l-1:r%l==0}}else{if(!this.blockComment)return!1;var d=this.blockComment.start,k=this.blockComment.end,p=new RegExp("^(\\s*)(?:"+lang.escapeRegExp(d)+")"),v=new RegExp("(?:"+lang.escapeRegExp(k)+")\\s*$"),c=function(e,t){m(e,t)||s&&!/\S/.test(e)||(o.insertInLine({row:t,column:e.length},k),o.insertInLine({row:t,column:a},d))},u=function(e,t){var n;(n=e.match(v))&&o.removeInLine(t,e.length-n[0].length,e.length),(n=e.match(p))&&o.removeInLine(t,n[1].length,n[0].length)},m=function(e,t){if(p.test(e))return!0;for(var n=i.getTokens(t),r=0;r<n.length;r++)if("comment"===n[r].type)return!0}}function $(e){for(var t=n;t<=r;t++)e(o.getLine(t),t)}var w=1/0;$(function(e,t){var n=e.search(/\S/);-1!==n?(n<a&&(a=n),h&&!m(e,t)&&(h=!1)):w>e.length&&(w=e.length)}),a==1/0&&(a=w,h=s=!1),t&&a%l!=0&&(a=Math.floor(a/l)*l),$(h?u:c)},this.toggleBlockComment=function(e,t,n,r){var i=this.blockComment;if(i){!i.start&&i[0]&&(i=i[0]);var o,s,h=(c=new TokenIterator(t,r.row,r.column)).getCurrentToken(),a=(t.selection,t.selection.toOrientedRange());if(h&&/comment/.test(h.type)){for(;h&&/comment/.test(h.type);){if(-1!=(m=h.value.indexOf(i.start))){var l=c.getCurrentTokenRow(),u=c.getCurrentTokenColumn()+m,g=new Range(l,u,l,u+i.start.length);break}h=c.stepBackward()}for(var c,m,h=(c=new TokenIterator(t,r.row,r.column)).getCurrentToken();h&&/comment/.test(h.type);){if(-1!=(m=h.value.indexOf(i.end))){var l=c.getCurrentTokenRow(),u=c.getCurrentTokenColumn()+m,f=new Range(l,u,l,u+i.end.length);break}h=c.stepForward()}f&&t.remove(f),g&&(t.remove(g),o=g.start.row,s=-i.start.length)}else s=i.start.length,o=n.start.row,t.insert(n.end,i.end),t.insert(n.start,i.start);a.start.row==o&&(a.start.column+=s),a.end.row==o&&(a.end.column+=s),t.selection.fromOrientedRange(a)}},this.getNextLineIndent=function(e,t,n){return this.$getIndent(t)},this.checkOutdent=function(e,t,n){return!1},this.autoOutdent=function(e,t,n){},this.$getIndent=function(e){return e.match(/^\s*/)[0]},this.createWorker=function(e){return null},this.createModeDelegates=function(e){for(var r in this.$embeds=[],this.$modes={},e){var t,n,i;e[r]&&(n=(t=e[r]).prototype.$id,(i=config.$modes[n])||(config.$modes[n]=i=new t),config.$modes[r]||(config.$modes[r]=i),this.$embeds.push(r),this.$modes[r]=i)}for(var o=["toggleBlockComment","toggleCommentLines","getNextLineIndent","checkOutdent","autoOutdent","transformAction","getCompletions"],r=0;r<o.length;r++)!function(e){var t=o[r],n=e[t];e[o[r]]=function(){return this.$delegator(t,arguments,n)}}(this)},this.$delegator=function(e,t,n){var r=t[0]||"start";if("string"!=typeof r){if(Array.isArray(r[2])){var i=r[2][r[2].length-1];if(s=this.$modes[i])return s[e].apply(s,[r[1]].concat([].slice.call(t,1)))}r=r[0]||"start"}for(var o=0;o<this.$embeds.length;o++)if(this.$modes[this.$embeds[o]]){var s,h=r.split(this.$embeds[o]);if(!h[0]&&h[1])return t[0]=h[1],(s=this.$modes[this.$embeds[o]])[e].apply(s,t)}i=n.apply(this,t);return n?i:void 0},this.transformAction=function(e,t,n,r,i){if(this.$behaviour){var o,s=this.$behaviour.getBehaviours();for(o in s)if(s[o][t]){var h=s[o][t].apply(this,arguments);if(h)return h}}},this.getKeywords=function(e){if(!this.completionKeywords){var t=this.$tokenizer.rules,n=[];for(s in t)for(var r=t[s],i=0,o=r.length;i<o;i++)if("string"==typeof r[i].token)/keyword|support|storage/.test(r[i].token)&&n.push(r[i].regex);else if("object"==typeof r[i].token)for(var s,h=0,a=r[i].token.length;h<a;h++)/keyword|support|storage/.test(r[i].token[h])&&(s=r[i].regex.match(/\(.+?\)/g)[h],n.push(s.substr(1,s.length-2)));this.completionKeywords=n}return e?n.concat(this.$keywordList||[]):this.$keywordList},this.$createKeywordList=function(){return this.$highlightRules||this.getTokenizer(),this.$keywordList=this.$highlightRules.$keywordList||[]},this.getCompletions=function(e,t,n,r){return(this.$keywordList||this.$createKeywordList()).map(function(e){return{name:e,value:e,score:0,meta:"keyword"}})},this.$id="ace/mode/text"}.call(Mode.prototype),exports.Mode=Mode;