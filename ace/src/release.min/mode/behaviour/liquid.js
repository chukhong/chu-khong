"use strict";var oop=require("../../lib/oop"),Behaviour=require("../behaviour").Behaviour,XmlBehaviour=require("./xml").XmlBehaviour,TokenIterator=require("../../token_iterator").TokenIterator,lang=require("../../lib/lang");function is(e,r){return e&&-1<e.type.lastIndexOf(r+".xml")}var LiquidBehaviour=function(){XmlBehaviour.call(this),this.add("autoBraceTagClosing","insertion",function(e,r,t,i,a){if("}"==a){var a=t.getSelectionRange().start,o=new TokenIterator(i,a.row,a.column),u=o.getCurrentToken()||o.stepBackward();if(u&&("%"===u.value.trim()||is(u,"tag-name")||is(u,"tag-whitespace")||is(u,"attribute-name")||is(u,"attribute-equals")||is(u,"attribute-value"))&&!is(u,"reference.attribute-value")){if(is(u,"attribute-value")){t=o.getCurrentTokenColumn()+u.value.length;if(a.column<t)return;if(a.column==t){t=o.stepForward();if(t&&is(t,"attribute-value"))return;o.stepBackward()}}if(!/{%\s*%/.test(i.getLine(a.row))&&!/^\s*}/.test(i.getLine(a.row).slice(a.column))){for(;"keyword.block"!=!u.type;)if("{%"==(u=o.stepBackward()).value){for(;;){if("keyword.block"===(u=o.stepForward()).type)break;if("%"==u.value.trim()){u=null;break}}break}if(u){t=o.getCurrentTokenRow(),i=o.getCurrentTokenColumn();if(!is(o.stepBackward(),"end-tag-open")){var n=u.value;if(t==a.row&&(n=n.substring(0,a.column-i)),!this.voidElements.hasOwnProperty(n.toLowerCase()))return{text:"}{% end"+n+" %}",selection:[1,1]}}}}}}})};oop.inherits(LiquidBehaviour,Behaviour),exports.LiquidBehaviour=LiquidBehaviour;