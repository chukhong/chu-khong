"use strict";exports.MaskHighlightRules=MaskHighlightRules;var const_FUNCTIONS,const_KEYWORDS,const_CONST,const_TAGS,oop=require("../lib/oop"),lang=require("../lib/lang"),TextRules=require("./text_highlight_rules").TextHighlightRules,JSRules=require("./javascript_highlight_rules").JavaScriptHighlightRules,CssRules=require("./css_highlight_rules").CssHighlightRules,MDRules=require("./markdown_highlight_rules").MarkdownHighlightRules,HTMLRules=require("./html_highlight_rules").HtmlHighlightRules,token_TAG="keyword.support.constant.language",token_COMPO="support.function.markup.bold",token_KEYWORD="keyword",token_LANG="constant.language",token_UTIL="keyword.control.markup.italic",token_ATTR="support.variable.class",token_PUNKT="keyword.operator",token_ITALIC="markup.italic",token_BOLD="markup.bold",token_LPARE="paren.lparen",token_RPARE="paren.rparen";function MaskHighlightRules(){this.$rules={start:[Token("comment","\\/\\/.*$"),Token("comment","\\/\\*",[Token("comment",".*?\\*\\/","start"),Token("comment",".+")]),Blocks.string("'''"),Blocks.string('"""'),Blocks.string('"'),Blocks.string("'"),Blocks.syntax(/(markdown|md)\b/,"md-multiline","multiline"),Blocks.syntax(/html\b/,"html-multiline","multiline"),Blocks.syntax(/(slot|event)\b/,"js-block","block"),Blocks.syntax(/style\b/,"css-block","block"),Blocks.syntax(/var\b/,"js-statement","attr"),Blocks.tag(),Token(token_LPARE,"[[({>]"),Token(token_RPARE,"[\\])};]","start"),{caseInsensitive:!0}]};var l=this;function t(t,e,o){n(JSRules,"js-"+t+"-",e,"block"===t?["start"]:["start","no_regex"],o)}function n(t,e,o,n,s){var r="pop",n=n||["start"];0===n.length&&(n=null),/block|multiline/.test(e)&&(l.$rules[r=e+"end"]=[Token("empty","","start")]),l.embedRules(t,e,[Token(s||token_RPARE,o,r)],n,null==n)}t("interpolation",/\]/,token_RPARE+"."+token_ITALIC),t("statement",/\)|}|;/),t("block",/\}/),n(CssRules,"css-block-",/\}/),n(MDRules,"md-multiline-",/("""|''')/,[]),n(HTMLRules,"html-multiline-",/("""|''')/),this.normalizeRules()}const_FUNCTIONS=lang.arrayToMap("log".split("|")),const_CONST=lang.arrayToMap(":dualbind|:bind|:import|slot|event|style|html|markdown|md".split("|")),const_KEYWORDS=lang.arrayToMap("debugger|define|var|if|each|for|of|else|switch|case|with|visible|+if|+each|+for|+switch|+with|+visible|include|import".split("|")),const_TAGS=lang.arrayToMap("a|abbr|acronym|address|applet|area|article|aside|audio|b|base|basefont|bdo|big|blockquote|body|br|button|canvas|caption|center|cite|code|col|colgroup|command|datalist|dd|del|details|dfn|dir|div|dl|dt|em|embed|fieldset|figcaption|figure|font|footer|form|frame|frameset|h1|h2|h3|h4|h5|h6|head|header|hgroup|hr|html|i|iframe|img|input|ins|keygen|kbd|label|legend|li|link|map|mark|menu|meta|meter|nav|noframes|noscript|object|ol|optgroup|option|output|p|param|pre|progress|q|rp|rt|ruby|s|samp|script|section|select|small|source|span|strike|strong|style|sub|summary|sup|table|tbody|td|textarea|tfoot|th|thead|time|title|tr|tt|u|ul|var|video|wbr|xmp".split("|")),oop.inherits(MaskHighlightRules,TextRules);var Blocks={string:function(t,e){e=Token("string.start",t,[Token(token_LPARE+"."+token_ITALIC,/~\[/,Blocks.interpolation()),Token("string.end",t,"pop"),{defaultToken:"string"}],e);return 1===t.length&&(t=Token("string.escape","\\\\"+t),e.push.unshift(t)),e},interpolation:function(){return[Token(token_UTIL,/\s*\w*\s*:/),"js-interpolation-start"]},tagHead:function(t){return Token(token_ATTR,t,[Token(token_ATTR,/[\w\-_]+/),Token(token_LPARE+"."+token_ITALIC,/~\[/,Blocks.interpolation()),Blocks.goUp()])},tag:function(){return{token:"tag",onMatch:function(t){return void 0!==const_KEYWORDS[t]?token_KEYWORD:void 0!==const_CONST[t]?token_LANG:void 0!==const_FUNCTIONS[t]?"support.function":void 0!==const_TAGS[t.toLowerCase()]?token_TAG:token_COMPO},regex:/([@\w\-_:+]+)|((^|\s)(?=\s*(\.|#)))/,push:[Blocks.tagHead(/\./),Blocks.tagHead(/#/),Blocks.expression(),Blocks.attribute(),Token(token_LPARE,/[;>{]/,"pop")]}},syntax:function(t,e,o){return{token:token_LANG,regex:t,push:{attr:[e+"-start",Token(token_PUNKT,/;/,"start")],multiline:[Blocks.tagHead(/\./),Blocks.tagHead(/#/),Blocks.attribute(),Blocks.expression(),Token(token_LPARE,/[>\{]/),Token(token_PUNKT,/;/,"start"),Token(token_LPARE,/'''|"""/,[e+"-start"])],block:[Blocks.tagHead(/\./),Blocks.tagHead(/#/),Blocks.attribute(),Blocks.expression(),Token(token_LPARE,/\{/,[e+"-start"])]}[o]}},attribute:function(){return Token(function(t){return/^x\-/.test(t)?token_ATTR+"."+token_BOLD:token_ATTR},/[\w_-]+/,[Token(token_PUNKT,/\s*=\s*/,[Blocks.string('"'),Blocks.string("'"),Blocks.word(),Blocks.goUp()]),Blocks.goUp()])},expression:function(){return Token(token_LPARE,/\(/,["js-statement-start"])},word:function(){return Token("string",/[\w-_]+/)},goUp:function(){return Token("text","","pop")},goStart:function(){return Token("text","","start")}};function Token(t,e,o){var n,s,r;return 4===arguments.length?(n=o,s=arguments[3]):"string"==typeof o?s=o:n=o,"function"==typeof t&&(r=t,t="empty"),{token:t,regex:e,push:n,next:s,onMatch:r}}