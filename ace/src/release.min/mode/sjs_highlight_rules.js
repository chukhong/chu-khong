"use strict";var oop=require("../lib/oop"),JavaScriptHighlightRules=require("./javascript_highlight_rules").JavaScriptHighlightRules,TextHighlightRules=require("./text_highlight_rules").TextHighlightRules,SJSHighlightRules=function(){for(var e=new JavaScriptHighlightRules({noES6:!0}),n="\\\\(?:x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|[0-2][0-7]{0,2}|3[0-6][0-7]?|37[0-7]?|[4-7][0-7]?|.)",r=function(e){return e.isContextAware=!0,e},t=function(t){return{token:t.token,regex:t.regex,next:r(function(e,n){return 0===n.length&&n.unshift(e),n.unshift(t.next),t.next})}},i=function(e){return{token:e.token,regex:e.regex,next:r(function(e,n){return n.shift(),n[0]||"start"})}},g=(this.$rules=e.$rules,this.$rules.no_regex=[{token:"keyword",regex:"(waitfor|or|and|collapse|spawn|retract)\\b"},{token:"keyword.operator",regex:"(->|=>|\\.\\.)"},{token:"variable.language",regex:"(hold|default)\\b"},t({token:"string",regex:"`",next:"bstring"}),t({token:"string",regex:'"',next:"qqstring"}),t({token:"string",regex:'"',next:"qqstring"}),{token:["paren.lparen","text","paren.rparen"],regex:"(\\{)(\\s*)(\\|)",next:"block_arguments"}].concat(this.$rules.no_regex),this.$rules.block_arguments=[{token:"paren.rparen",regex:"\\|",next:"no_regex"}].concat(this.$rules.function_arguments),this.$rules.bstring=[{token:"constant.language.escape",regex:n},{token:"string",regex:"\\\\$",next:"bstring"},t({token:"paren.lparen",regex:"\\$\\{",next:"string_interp"}),t({token:"paren.lparen",regex:"\\$",next:"bstring_interp_single"}),i({token:"string",regex:"`"}),{defaultToken:"string"}],this.$rules.qqstring=[{token:"constant.language.escape",regex:n},{token:"string",regex:"\\\\$",next:"qqstring"},t({token:"paren.lparen",regex:"#\\{",next:"string_interp"}),i({token:"string",regex:'"'}),{defaultToken:"string"}],[]),s=0;s<this.$rules.no_regex.length;s++){var a=this.$rules.no_regex[s];-1!=String(a.token).indexOf("paren")||a.next&&!a.next.isContextAware||g.push(a)}this.$rules.string_interp=[i({token:"paren.rparen",regex:"\\}"}),t({token:"paren.lparen",regex:"{",next:"string_interp"})].concat(g),this.$rules.bstring_interp_single=[{token:["identifier","paren.lparen"],regex:"(\\w+)(\\()",next:"bstring_interp_single_call"},i({token:"identifier",regex:"\\w*"})],this.$rules.bstring_interp_single_call=[t({token:"paren.lparen",regex:"\\(",next:"bstring_interp_single_call"}),i({token:"paren.rparen",regex:"\\)"})].concat(g)};oop.inherits(SJSHighlightRules,TextHighlightRules),exports.SJSHighlightRules=SJSHighlightRules;