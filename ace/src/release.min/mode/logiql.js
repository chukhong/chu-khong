"use strict";var oop=require("../lib/oop"),TextMode=require("./text").Mode,LogiQLHighlightRules=require("./logiql_highlight_rules").LogiQLHighlightRules,FoldMode=require("./folding/coffee").FoldMode,TokenIterator=require("../token_iterator").TokenIterator,Range=require("../range").Range,CstyleBehaviour=require("./behaviour/cstyle").CstyleBehaviour,MatchingBraceOutdent=require("./matching_brace_outdent").MatchingBraceOutdent,Mode=function(){this.HighlightRules=LogiQLHighlightRules,this.foldingRules=new FoldMode,this.$outdent=new MatchingBraceOutdent,this.$behaviour=new CstyleBehaviour};oop.inherits(Mode,TextMode),function(){this.lineCommentStart="//",this.blockComment={start:"/*",end:"*/"},this.getNextLineIndent=function(e,t,n){var o=this.$getIndent(t),e=this.getTokenizer().getLineTokens(t,e),i=e.tokens,e=e.state;return/comment|string/.test(e)||i.length&&"comment.single"==i[i.length-1].type||(t.match(),/(-->|<--|<-|->|{)\s*$/.test(t)&&(o+=n)),o},this.checkOutdent=function(e,t,n){return!!this.$outdent.checkOutdent(t,n)||("\n"===n||"\r\n"===n)&&!!/^\s+/.test(t)},this.autoOutdent=function(e,t,n){var o,i,r;if(!this.$outdent.autoOutdent(t,n))return r=(i=t.getLine(n)).match(/^\s+/),i=i.lastIndexOf(".")+1,r&&n&&i&&(t.getLine(n+1),o=this.getMatching(t,{row:n,column:i}))&&o.start.row!=n?(i=r[0].length,r=this.$getIndent(t.getLine(o.start.row)),void t.replace(new Range(n+1,0,n+1,i),r)):0},this.getMatching=function(e,t,n){"object"==typeof(t=null==t?e.selection.lead:t)&&(n=t.column,t=t.row);var o,i,r=e.getTokenAt(t,n),s="keyword.start",u="keyword.end";if(r){if(r.type==s)(i=new TokenIterator(e,t,n)).step=i.stepForward;else{if(r.type!=u)return;(i=new TokenIterator(e,t,n)).step=i.stepBackward}for(;(o=i.step())&&o.type!=s&&o.type!=u;);if(o&&o.type!=r.type)return e=i.getCurrentTokenColumn(),t=i.getCurrentTokenRow(),new Range(t,e,t,e+o.value.length)}},this.$id="ace/mode/logiql"}.call(Mode.prototype),exports.Mode=Mode;