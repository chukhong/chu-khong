"use strict";var oop=require("../lib/oop"),TextMode=require("./text").Mode,VBScriptHighlightRules=require("./vbscript_highlight_rules").VBScriptHighlightRules,FoldMode=require("./folding/vbscript").FoldMode,Range=require("../range").Range,Mode=function(){this.HighlightRules=VBScriptHighlightRules,this.foldingRules=new FoldMode,this.$behaviour=this.$defaultBehaviour,this.indentKeywords=this.foldingRules.indentKeywords};oop.inherits(Mode,TextMode),function(){this.lineCommentStart=["'","REM"];var i=["else","elseif","end","loop","next","wend"];this.getNextLineIndent=function(e,t,n){var i=this.$getIndent(t),s=0,o=this.getTokenizer().getLineTokens(t,e).tokens;return 0<(s="start"==e?function(e,t,n){for(var i=0,s=0;s<e.length;s++){var o=e[s];if("keyword.control.asp"==o.type||"storage.type.function.asp"==o.type){var r=o.value.toLowerCase();if(r in n)switch(r){case"property":case"sub":case"function":case"select":case"do":case"for":case"class":case"while":case"with":case"if":var a=new RegExp("^\\s* end\\s+"+r,"i");/^\s*If\s+.*\s+Then(?!')\s+(?!')\S/i.test(t)||a.test(t)||(i+=n[r]);break;default:i+=n[r]}}}return i<0?-1:0<i?1:0}(o,t,this.indentKeywords):s)?i+n:s<0&&i.substr(i.length-n.length)==n&&!this.checkOutdent(e,t,"\n")?i.substr(0,i.length-n.length):i},this.checkOutdent=function(e,t,n){return("\n"==n||"\r"==n||"\r\n"==n)&&!(!(n=this.getTokenizer().getLineTokens(t.trim(),e).tokens)||!n.length||(t=n[0].value.toLowerCase(),"keyword.control.asp"!=n[0].type&&"storage.type.function.asp"!=n[0].type)||-1==i.indexOf(t))},this.getMatching=function(e,t,n,i){null==t&&(n=(s=e.selection.lead).column,t=s.row),null==i&&(i=!0);var s=e.getTokenAt(t,n);if(s&&s.value.toLowerCase()in this.indentKeywords)return this.foldingRules.vbsBlock(e,t,n,i)},this.autoOutdent=function(e,t,n){var i,s=t.getLine(n).match(/^\s*/)[0].length;s&&n&&(i=this.getMatching(t,n,s+1,!1))&&i.start.row!=n&&(i=this.$getIndent(t.getLine(i.start.row))).length!=s&&(t.replace(new Range(n,0,n,s),i),t.outdentRows(new Range(n+1,0,n+1,0)))},this.$id="ace/mode/vbscript"}.call(Mode.prototype),exports.Mode=Mode;