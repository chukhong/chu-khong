"use strict";var oop=require("../../lib/oop"),Range=require("../../range").Range,BaseFoldMode=require("./fold_mode").FoldMode,FoldMode=exports.FoldMode=function(e){e&&(this.foldingStartMarker=new RegExp(this.foldingStartMarker.source.replace(/\|[^|]*?$/,"|"+e.start)),this.foldingStopMarker=new RegExp(this.foldingStopMarker.source.replace(/\|[^|]*?$/,"|"+e.end)))};oop.inherits(FoldMode,BaseFoldMode),function(){this.foldingStartMarker=/([\{\[\(])[^\}\]\)]*$|^\s*(\/\*)/,this.foldingStopMarker=/^[^\[\{\(]*([\}\]\)])|^[\s\*]*(\*\/)/,this.singleLineBlockCommentRe=/^\s*(\/\*).*\*\/\s*$/,this.tripleStarBlockCommentRe=/^\s*(\/\*\*\*).*\*\/\s*$/,this.startRegionRe=/^\s*(\/\*|\/\/)#?region\b/,this._getFoldWidgetBase=this.getFoldWidget,this.getFoldWidget=function(e,t,i){var n=e.getLine(i);return!this.singleLineBlockCommentRe.test(n)||this.startRegionRe.test(n)||this.tripleStarBlockCommentRe.test(n)?!(e=this._getFoldWidgetBase(e,t,i))&&this.startRegionRe.test(n)?"start":e:""},this.getFoldWidgetRange=function(e,t,i,n){var o,r,s,g=e.getLine(i);return this.startRegionRe.test(g)?this.getCommentRegionBlock(e,g,i):(r=g.match(this.foldingStartMarker))?(s=r.index,r[1]?this.openingBracketBlock(e,r[1],i,s):((o=e.getCommentFoldRange(i,s+r[0].length,1))&&!o.isMultiLine()&&(n?o=this.getSectionRange(e,i):"all"!=t&&(o=null)),o)):"markbegin"!==t&&(r=g.match(this.foldingStopMarker))?(s=r.index+r[0].length,r[1]?this.closingBracketBlock(e,r[1],i,s):e.getCommentFoldRange(i,s,-1)):void 0},this.getSectionRange=function(e,t){for(var i=(g=e.getLine(t)).search(/\S/),n=t,o=g.length,r=t+=1,s=e.getLength();++t<s;){var g,a=(g=e.getLine(t)).search(/\S/);if(-1!==a){if(a<i)break;var l=this.getFoldWidgetRange(e,"all",t);if(l){if(l.start.row<=n)break;if(l.isMultiLine())t=l.end.row;else if(i==a)break}r=t}}return new Range(n,o,r,e.getLine(r).length)},this.getCommentRegionBlock=function(e,t,i){for(var n=t.search(/\s*$/),o=e.getLength(),r=i,s=/^\s*(?:\/\*|\/\/|--)#?(end)?region\b/,g=1;++i<o;){t=e.getLine(i);var a=s.exec(t);if(a&&(a[1]?g--:g++,!g))break}if(r<i)return new Range(r,n,i,t.length)}}.call(FoldMode.prototype);