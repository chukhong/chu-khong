"use strict";var oop=require("../../lib/oop"),BaseFoldMode=require("./fold_mode").FoldMode,Range=require("../../range").Range,FoldMode=exports.FoldMode=function(){};oop.inherits(FoldMode,BaseFoldMode),function(){this.foldingStartMarker=/^(?:[=-]+\s*$|#{1,6} |`{3})/,this.getFoldWidget=function(e,t,r){var n=e.getLine(r);return this.foldingStartMarker.test(n)?"`"==n[0]&&"start"==e.bgTokenizer.getState(r)?"end":"start":""},this.getFoldWidgetRange=function(t,e,r){var n=t.getLine(r),i=n.length,o=t.getLength(),a=r,g=r;if(n.match(this.foldingStartMarker)){if("`"==n[0]){if("start"!==t.bgTokenizer.getState(r)){for(;++r<o&&!("`"==(n=t.getLine(r))[0]&"```"==n.substring(0,3)););return new Range(a,i,r,0)}for(;0<r--&&!("`"==(n=t.getLine(r))[0]&"```"==n.substring(0,3)););return new Range(r,n.length,a,0)}var d,s="markup.heading";if(u(r)){for(var f,l=h();++r<o;)if(u(r))if(l<=h())break;if(a<(g=r-(d&&-1!=["=","-"].indexOf(d.value[0])?2:1)))for(;a<g&&/^\s*$/.test(t.getLine(g));)g--;if(a<g)return f=t.getLine(g).length,new Range(a,i,g,f)}}function u(e){return(d=t.getTokens(e)[0])&&0===d.type.lastIndexOf(s,0)}function h(){var e=d.value[0];return"="==e?6:"-"==e?5:7-d.value.search(/[^#]|$/)}}}.call(FoldMode.prototype);