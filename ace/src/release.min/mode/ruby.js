"use strict";var oop=require("../lib/oop"),TextMode=require("./text").Mode,RubyHighlightRules=require("./ruby_highlight_rules").RubyHighlightRules,MatchingBraceOutdent=require("./matching_brace_outdent").MatchingBraceOutdent,Range=require("../range").Range,CstyleBehaviour=require("./behaviour/cstyle").CstyleBehaviour,FoldMode=require("./folding/ruby").FoldMode,Mode=function(){this.HighlightRules=RubyHighlightRules,this.$outdent=new MatchingBraceOutdent,this.$behaviour=new CstyleBehaviour,this.foldingRules=new FoldMode,this.indentKeywords=this.foldingRules.indentKeywords};oop.inherits(Mode,TextMode),function(){this.lineCommentStart="#",this.getNextLineIndent=function(e,t,n){var i,s=this.$getIndent(t),o=this.getTokenizer().getLineTokens(t,e).tokens;return o.length&&"comment"==o[o.length-1].type||"start"==e&&(o=t.match(/^.*[\{\(\[]\s*$/),e=t.match(/^\s*(class|def|module)\s.*$/),i=t.match(/.*do(\s*|\s+\|.*\|\s*)$/),t=t.match(/^\s*(if|else|when|elsif|unless|while|for|begin|rescue|ensure)\s*/),o||e||i||t)&&(s+=n),s},this.checkOutdent=function(e,t,n){return/^\s+(end|else|rescue|ensure)$/.test(t+n)||this.$outdent.checkOutdent(t,n)},this.autoOutdent=function(e,t,n){var i=t.getLine(n);if(/}/.test(i))return this.$outdent.autoOutdent(t,n);var i=this.$getIndent(i),s=t.getLine(n-1),s=this.$getIndent(s),o=t.getTabString();s.length<=i.length&&i.slice(-o.length)==o&&t.remove(new Range(n,i.length-o.length,n,i.length))},this.getMatching=function(e,t,n){null==t&&(n=(i=e.selection.lead).column,t=i.row);var i=e.getTokenAt(t,n);if(i&&i.value in this.indentKeywords)return this.foldingRules.rubyBlock(e,t,n,!0)},this.$id="ace/mode/ruby",this.snippetFileId="ace/snippets/ruby"}.call(Mode.prototype),exports.Mode=Mode;