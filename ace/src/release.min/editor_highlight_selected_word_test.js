"undefined"!=typeof process&&(require("amd-loader"),require("./test/mockdom"));var EditSession=require("./edit_session").EditSession,Editor=require("./editor").Editor,MockRenderer=require("./test/mockrenderer").MockRenderer,assert=require("./test/assertions"),lipsum="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris at arcu mi, eu lobortis mauris. Quisque ut libero eget diam congue vehicula. Quisque ut odio ut mi aliquam tincidunt. Duis lacinia aliquam lorem eget eleifend. Morbi eget felis mi. Duis quam ligula, consequat vitae convallis volutpat, blandit nec neque. Nulla facilisi. Etiam suscipit lorem ac justo sollicitudin tristique. Phasellus ut posuere nunc. Aliquam scelerisque mollis felis non gravida. Vestibulum lacus sem, posuere non bibendum id, luctus non dolor. Aenean id metus lorem, vel dapibus est. Donec gravida feugiat augue nec accumsan.Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla vulputate, velit vitae tincidunt congue, nunc augue accumsan velit, eu consequat turpis lectus ac orci. Pellentesque ornare dolor feugiat dui auctor eu varius nulla fermentum. Sed aliquam odio at velit lacinia vel fermentum felis sodales. In dignissim magna eget nunc lobortis non fringilla nibh ullamcorper. Donec facilisis malesuada elit at egestas. Etiam bibendum, diam vitae tempor aliquet, dui libero vehicula odio, eget bibendum mauris velit eu lorem.\nconsectetur";function callHighlighterUpdate(e,s,t){var i=0;return e.$searchHighlight.update([],{drawSingleLineMarker:function(){i++}},e,{firstRow:s,lastRow:t}),i}module.exports={setUp:function(e){this.session=new EditSession(lipsum),this.editor=new Editor(new MockRenderer,this.session),this.selection=this.session.getSelection(),this.search=this.editor.$search,e()},"test: highlight selected words by default":function(){assert.equal(this.editor.getHighlightSelectedWord(),!0)},"test: highlight a word":function(){this.editor.moveCursorTo(0,9),this.selection.selectWord();var e=this.editor.session.$searchHighlight,s=(assert.ok(null!=e),this.selection.getRange());assert.equal(this.session.getTextRange(s),"ipsum"),assert.equal(e.cache.length,0),assert.equal(callHighlighterUpdate(this.session,0,0),2)},"test: highlight a word and clear highlight":function(){this.editor.moveCursorTo(0,8),this.selection.selectWord();var e=this.selection.getRange();assert.equal(this.session.getTextRange(e),"ipsum"),assert.equal(callHighlighterUpdate(this.session,0,0),2),this.session.highlight(""),assert.equal(this.session.$searchHighlight.cache.length,0),assert.equal(callHighlighterUpdate(this.session,0,0),0)},"test: highlight another word":function(){this.selection.moveCursorTo(0,14),this.selection.selectWord();var e=this.selection.getRange();assert.equal(this.session.getTextRange(e),"dolor"),assert.equal(callHighlighterUpdate(this.session,0,0),4)},"test: no selection, no highlight":function(){this.selection.clearSelection(),assert.equal(callHighlighterUpdate(this.session,0,0),0)},"test: select a word, no highlight":function(){this.selection.moveCursorTo(0,14),this.selection.selectWord(),this.editor.setHighlightSelectedWord(!1);var e=this.selection.getRange();assert.equal(this.session.getTextRange(e),"dolor"),assert.equal(callHighlighterUpdate(this.session,0,0),0)},"test: select a word with no matches":function(){this.editor.setHighlightSelectedWord(!0);var e=this.search.getOptions(),s=(this.search.set({wrap:!0,wholeWord:!0,caseSensitive:!0,needle:"Mauris"}),this.search.find(this.session));assert.notEqual(s,null,"found a match for 'Mauris'"),this.search.set(e),this.selection.setSelectionRange(s),assert.equal(this.session.getTextRange(s),"Mauris"),assert.equal(callHighlighterUpdate(this.session,0,0),1)},"test: partial word selection 1":function(){this.selection.moveCursorTo(0,14),this.selection.selectWord(),this.selection.selectLeft();var e=this.selection.getRange();assert.equal(this.session.getTextRange(e),"dolo"),assert.equal(callHighlighterUpdate(this.session,0,0),0)},"test: partial word selection 2":function(){this.selection.moveCursorTo(0,13),this.selection.selectWord(),this.selection.selectRight();var e=this.selection.getRange();assert.equal(this.session.getTextRange(e),"dolor "),assert.equal(callHighlighterUpdate(this.session,0,0),3)},"test: partial word selection 3":function(){(e=this.selection.getWordRange(0,14)).start.column++,this.selection.setRange(e);var e=this.selection.getRange();assert.equal(this.session.getTextRange(e),"olor"),assert.equal(callHighlighterUpdate(this.session,0,0),0)},"test: select last word":function(){this.selection.moveCursorTo(0,1);var e=this.search.getOptions(),s=(this.search.set({wrap:!0,wholeWord:!0,caseSensitive:!0,backwards:!0,needle:"consectetur"}),this.search.find(this.session));assert.notEqual(s,null,"found a match for 'consectetur'"),assert.position(s.start,1,0),this.search.set(e),this.selection.setSelectionRange(s),assert.equal(this.session.getTextRange(s),"consectetur"),assert.equal(callHighlighterUpdate(this.session,0,1),3)}},"undefined"!=typeof module&&module===require.main&&require("asyncjs").test.testcase(module.exports).exec();