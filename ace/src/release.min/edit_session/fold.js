"use strict";var RangeList=require("../range_list").RangeList,oop=require("../lib/oop"),Fold=exports.Fold=function(t,o){this.foldLine=null,this.placeholder=o,this.range=t,this.start=t.start,this.end=t.end,this.sameRow=t.start.row==t.end.row,this.subFolds=this.ranges=[]};function consumePoint(t,o){t.row-=o.row,0==t.row&&(t.column-=o.column)}function consumeRange(t,o){consumePoint(t.start,o),consumePoint(t.end,o)}function restorePoint(t,o){0==t.row&&(t.column+=o.column),t.row+=o.row}function restoreRange(t,o){restorePoint(t.start,o),restorePoint(t.end,o)}oop.inherits(Fold,RangeList),function(){this.toString=function(){return'"'+this.placeholder+'" '+this.range.toString()},this.setFoldLine=function(o){this.foldLine=o,this.subFolds.forEach(function(t){t.setFoldLine(o)})},this.clone=function(){var t=this.range.clone(),o=new Fold(t,this.placeholder);return this.subFolds.forEach(function(t){o.subFolds.push(t.clone())}),o.collapseChildren=this.collapseChildren,o},this.addSubFold=function(t){if(!this.range.isEqual(t)){consumeRange(t,this.start);for(var o=t.start.row,n=t.start.column,s=0,e=-1;s<this.subFolds.length&&1==(e=this.subFolds[s].range.compare(o,n));s++);var r=this.subFolds[s],i=0;if(0==e){if(r.range.containsRange(t))return r.addSubFold(t);i=1}for(var o=t.range.end.row,n=t.range.end.column,l=s,e=-1;l<this.subFolds.length&&1==(e=this.subFolds[l].range.compare(o,n));l++);0==e&&l++;for(var a=this.subFolds.splice(s,l-s,t),u=0==e?a.length-1:a.length,h=i;h<u;h++)t.addSubFold(a[h]);return t.setFoldLine(this.foldLine),t}},this.restoreRange=function(t){return restoreRange(t,this.start)}}.call(Fold.prototype);