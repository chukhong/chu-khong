"use strict";var dom=require("../lib/dom"),oop=require("../lib/oop"),event=require("../lib/event"),Tooltip=require("../tooltip").Tooltip;function GutterHandler(i){var n,r,s,l=i.editor,u=l.renderer.$gutterLayer,c=new GutterTooltip(l.container);function a(){n=n&&clearTimeout(n),s&&(c.hide(),s=null,l._signal("hideGutterTooltip",c),l.off("mousewheel",a))}function d(e){c.setPosition(e.x,e.y)}i.editor.setDefaultHandler("guttermousedown",function(e){if(l.isFocused()&&0==e.getButton()){var t=u.getRegion(e);if("foldWidgets"!=t){var t=e.getDocumentPosition().row,o=l.session.selection;if(e.getShiftKey())o.selectTo(t,0);else{if(2==e.domEvent.detail)return l.selectAll(),e.preventDefault();i.$clickSelection=l.selection.getLineRange(t)}return i.setState("selectByLines"),i.captureMouse(e),e.preventDefault()}}}),i.editor.setDefaultHandler("guttermousemove",function(e){var t=e.domEvent.target||e.domEvent.srcElement;if(dom.hasCssClass(t,"ace_fold-widget"))return a();s&&i.$tooltipFollowsMouse&&d(e),r=e,n=n||setTimeout(function(){if(n=null,r&&!i.isMousePressed){var e=r.getDocumentPosition().row,t=u.$annotations[e];if(t){if(e==l.session.getLength()){var e=l.renderer.pixelToScreenCoordinates(0,r.y).row,o=r.$pos;if(e>l.session.documentToScreenRow(o.row,o.column))return void a()}s!=t&&(s=t.text.join("<br/>"),c.setHtml(s),(e=t.className)&&c.setClassName(e.trim()),c.show(),l._signal("showGutterTooltip",c),l.on("mousewheel",a),i.$tooltipFollowsMouse?d(r):(o=r.domEvent.target.getBoundingClientRect(),(t=c.getElement().style).left=o.right+"px",t.top=o.bottom+"px"))}else a()}else a()},50)}),event.addListener(l.renderer.$gutter,"mouseout",function(e){r=null,s&&(n=n||setTimeout(function(){n=null,a()},50))},l),l.on("changeSession",a)}function GutterTooltip(e){Tooltip.call(this,e)}oop.inherits(GutterTooltip,Tooltip),function(){this.setPosition=function(e,t){var o=window.innerWidth||document.documentElement.clientWidth,i=window.innerHeight||document.documentElement.clientHeight,n=this.getWidth(),r=this.getHeight();o<(e+=15)+n&&(e-=e+n-o),i<(t+=15)+r&&(t-=20+r),Tooltip.prototype.setPosition.call(this,e,t)}}.call(GutterTooltip.prototype),exports.GutterHandler=GutterHandler;