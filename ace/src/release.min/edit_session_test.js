"undefined"!=typeof process&&(require("amd-loader"),require("./test/mockdom"));var lang=require("./lib/lang"),EditSession=require("./edit_session").EditSession,Editor=require("./editor").Editor,UndoManager=require("./undomanager").UndoManager,MockRenderer=require("./test/mockrenderer").MockRenderer,Range=require("./range").Range,assert=require("./test/assertions"),JavaScriptMode=require("./mode/javascript").Mode;function createFoldTestSession(){var e=new EditSession(["function foo(items) {","    for (var i=0; i<items.length; i++) {",'        alert(items[i] + "juhu");',"    }    // Real Tab.","}"].join("\n"));return e.setUndoManager(new UndoManager),e.addFold("args...",new Range(0,13,0,18)),e.addFold("foo...",new Range(1,10,2,10)),e.addFold("bar...",new Range(2,20,2,25)),e}function assertArray(e,o){assert.equal(e+"",o+""),assert.ok(e.length==o.length);for(var n=0;n<e.length;n++)assert.equal(e[n],o[n])}require("./multi_select"),module.exports={"test: find matching opening bracket in Text mode":function(){var e=new EditSession(["(()(","())))"]);assert.position(e.findMatchingBracket({row:0,column:3}),0,1),assert.position(e.findMatchingBracket({row:1,column:2}),1,0),assert.position(e.findMatchingBracket({row:1,column:3}),0,3),assert.position(e.findMatchingBracket({row:1,column:4}),0,0),assert.equal(e.findMatchingBracket({row:1,column:5}),null)},"test: find matching closing bracket in Text mode":function(){var e=new EditSession(["(()(","())))"]);assert.position(e.findMatchingBracket({row:1,column:1}),1,1),assert.position(e.findMatchingBracket({row:1,column:1}),1,1),assert.position(e.findMatchingBracket({row:0,column:4}),1,2),assert.position(e.findMatchingBracket({row:0,column:2}),0,2),assert.position(e.findMatchingBracket({row:0,column:1}),1,3),assert.equal(e.findMatchingBracket({row:0,column:0}),null)},"test: find matching opening bracket in JavaScript mode":function(){var e=new EditSession(["function foo() {",'    var str = "{ foo()";',"    if (debug) {","        // write str (a string) to the console","        console.log(str);","    }",'    str += " bar() }";',"}"].join("\n"),new JavaScriptMode);assert.position(e.findMatchingBracket({row:0,column:14}),0,12),assert.position(e.findMatchingBracket({row:7,column:1}),0,15),assert.position(e.findMatchingBracket({row:6,column:20}),1,15),assert.position(e.findMatchingBracket({row:1,column:22}),1,20),assert.position(e.findMatchingBracket({row:3,column:31}),3,21),assert.position(e.findMatchingBracket({row:4,column:24}),4,19),assert.equal(e.findMatchingBracket({row:0,column:1}),null)},"test: find matching closing bracket in JavaScript mode":function(){var e=new EditSession(["function foo() {",'    var str = "{ foo()";',"    if (debug) {","        // write str (a string) to the console","        console.log(str);","    }",'    str += " bar() }";',"}"].join("\n"),new JavaScriptMode);assert.position(e.findMatchingBracket({row:0,column:13}),0,13),assert.position(e.findMatchingBracket({row:0,column:16}),7,0),assert.position(e.findMatchingBracket({row:1,column:16}),6,19),assert.position(e.findMatchingBracket({row:1,column:21}),1,21),assert.position(e.findMatchingBracket({row:3,column:22}),3,30),assert.position(e.findMatchingBracket({row:4,column:20}),4,23)},"test: handle unbalanced brackets in JavaScript mode":function(){var e=new EditSession(["function foo() {",'    var str = "{ foo()";',"    if (debug) {","        // write str a string) to the console","        console.log(str);","    ",'    str += " bar() ";',"}"].join("\n"),new JavaScriptMode);assert.equal(e.findMatchingBracket({row:0,column:16}),null),assert.equal(e.findMatchingBracket({row:3,column:30}),null),assert.equal(e.findMatchingBracket({row:1,column:16}),null)},"test: match different bracket types":function(){var e=new EditSession(["({[",")]}"]);assert.position(e.findMatchingBracket({row:0,column:1}),1,0),assert.position(e.findMatchingBracket({row:0,column:2}),1,2),assert.position(e.findMatchingBracket({row:0,column:3}),1,1),assert.position(e.findMatchingBracket({row:1,column:1}),0,0),assert.position(e.findMatchingBracket({row:1,column:2}),0,2),assert.position(e.findMatchingBracket({row:1,column:3}),0,1)},"test: move lines down":function(){var e=new EditSession(["a1","a2","a3","a4"]);e.moveLinesDown(0,1),assert.equal(e.getValue(),["a3","a1","a2","a4"].join("\n")),e.moveLinesDown(1,2),assert.equal(e.getValue(),["a3","a4","a1","a2"].join("\n")),e.moveLinesDown(2,3),assert.equal(e.getValue(),["a3","a4","a1","a2"].join("\n")),e.moveLinesDown(2,2),assert.equal(e.getValue(),["a3","a4","a2","a1"].join("\n"))},"test: move lines up":function(){var e=new EditSession(["a1","a2","a3","a4"]);e.moveLinesUp(2,3),assert.equal(e.getValue(),["a1","a3","a4","a2"].join("\n")),e.moveLinesUp(1,2),assert.equal(e.getValue(),["a3","a4","a1","a2"].join("\n")),e.moveLinesUp(0,1),assert.equal(e.getValue(),["a3","a4","a1","a2"].join("\n")),e.moveLinesUp(2,2),assert.equal(e.getValue(),["a3","a1","a4","a2"].join("\n"))},"test: duplicate lines":function(){var e=new EditSession(["1","2","3","4"]);e.duplicateLines(1,2),assert.equal(e.getValue(),["1","2","3","2","3","4"].join("\n"))},"test: duplicate last line":function(){var e=new EditSession(["1","2","3"]);e.duplicateLines(2,2),assert.equal(e.getValue(),["1","2","3","3"].join("\n"))},"test: duplicate first line":function(){var e=new EditSession(["1","2","3"]);e.duplicateLines(0,0),assert.equal(e.getValue(),["1","1","2","3"].join("\n"))},"test: getScreenLastRowColumn":function(){var e=new EditSession(["juhu","12\t\t34","ぁぁa"]);assert.equal(e.getScreenLastRowColumn(0),4),assert.equal(e.getScreenLastRowColumn(1),10),assert.equal(e.getScreenLastRowColumn(2),5)},"test: convert document to screen coordinates":function(){var e=new EditSession("01234\t567890\t1234");e.setTabSize(4),assert.equal(e.documentToScreenColumn(0,0),0),assert.equal(e.documentToScreenColumn(0,4),4),assert.equal(e.documentToScreenColumn(0,5),5),assert.equal(e.documentToScreenColumn(0,6),8),assert.equal(e.documentToScreenColumn(0,12),14),assert.equal(e.documentToScreenColumn(0,13),16),e.setTabSize(2),assert.equal(e.documentToScreenColumn(0,0),0),assert.equal(e.documentToScreenColumn(0,4),4),assert.equal(e.documentToScreenColumn(0,5),5),assert.equal(e.documentToScreenColumn(0,6),6),assert.equal(e.documentToScreenColumn(0,7),7),assert.equal(e.documentToScreenColumn(0,12),12),assert.equal(e.documentToScreenColumn(0,13),14)},"test: convert document to screen coordinates with leading tabs":function(){var e=new EditSession("\t\t123");e.setTabSize(4),assert.equal(e.documentToScreenColumn(0,0),0),assert.equal(e.documentToScreenColumn(0,1),4),assert.equal(e.documentToScreenColumn(0,2),8),assert.equal(e.documentToScreenColumn(0,3),9)},"test: documentToScreen without soft wrap":function(){var e=new EditSession(["juhu","12\t\t34","ぁぁa"]);assert.position(e.documentToScreenPosition(0,3),0,3),assert.position(e.documentToScreenPosition(1,3),1,4),assert.position(e.documentToScreenPosition(1,4),1,8),assert.position(e.documentToScreenPosition(2,2),2,4)},"test: documentToScreen with soft wrap":function(){var e=new EditSession(["foo bar foo bar"]);e.setUseWrapMode(!0),e.setWrapLimitRange(12,12),e.adjustWrapLimit(80),e.setOption("wrapMethod","text"),assert.position(e.documentToScreenPosition(0,11),0,11),assert.position(e.documentToScreenPosition(0,12),1,0)},"test: documentToScreen with soft wrap and multibyte characters":function(){var e=new EditSession(["ぁぁa"]);e.setUseWrapMode(!0),e.setWrapLimitRange(2,2),e.adjustWrapLimit(80),assert.position(e.documentToScreenPosition(0,1),1,0),assert.position(e.documentToScreenPosition(0,2),2,0),assert.position(e.documentToScreenPosition(0,4),2,1)},"test: documentToScreen should clip position to the document boundaries":function(){var e=new EditSession("foo bar\njuhu kinners");assert.position(e.documentToScreenPosition(-1,4),0,0),assert.position(e.documentToScreenPosition(3,0),1,12)},"test: convert screen to document coordinates":function(){var e=new EditSession("01234\t567890\t1234");e.setTabSize(4),assert.equal(e.screenToDocumentColumn(0,0),0),assert.equal(e.screenToDocumentColumn(0,4),4),assert.equal(e.screenToDocumentColumn(0,5),5),assert.equal(e.screenToDocumentColumn(0,6),5),assert.equal(e.screenToDocumentColumn(0,7),5),assert.equal(e.screenToDocumentColumn(0,8),6),assert.equal(e.screenToDocumentColumn(0,9),7),assert.equal(e.screenToDocumentColumn(0,15),12),assert.equal(e.screenToDocumentColumn(0,19),16),e.setTabSize(2),assert.equal(e.screenToDocumentColumn(0,0),0),assert.equal(e.screenToDocumentColumn(0,4),4),assert.equal(e.screenToDocumentColumn(0,5),5),assert.equal(e.screenToDocumentColumn(0,6),6),assert.equal(e.screenToDocumentColumn(0,12),12),assert.equal(e.screenToDocumentColumn(0,13),12),assert.equal(e.screenToDocumentColumn(0,14),13)},"test: screenToDocument with soft wrap":function(){var e=new EditSession(["foo bar foo bar"]);e.setUseWrapMode(!0),e.setWrapLimitRange(12,12),e.adjustWrapLimit(80),assert.position(e.screenToDocumentPosition(1,0),0,12),assert.position(e.screenToDocumentPosition(0,11),0,11),assert.position(e.screenToDocumentPosition(0,12),0,11),assert.position(e.screenToDocumentPosition(0,20),0,11)},"test: screenToDocument with soft wrap and multi byte characters":function(){var e=new EditSession(["ぁ a"]);e.setUseWrapMode(!0),e.adjustWrapLimit(80),assert.position(e.screenToDocumentPosition(0,1),0,0),assert.position(e.screenToDocumentPosition(0,2),0,1),assert.position(e.screenToDocumentPosition(0,3),0,2),assert.position(e.screenToDocumentPosition(0,4),0,3),assert.position(e.screenToDocumentPosition(0,5),0,3)},"test: screenToDocument should clip position to the document boundaries":function(){var e=new EditSession("foo bar\njuhu kinners");assert.position(e.screenToDocumentPosition(-1,4),0,0),assert.position(e.screenToDocumentPosition(0,-1),0,0),assert.position(e.screenToDocumentPosition(0,30),0,7),assert.position(e.screenToDocumentPosition(2,4),1,12),assert.position(e.screenToDocumentPosition(1,30),1,12),assert.position(e.screenToDocumentPosition(20,50),1,12),assert.position(e.screenToDocumentPosition(20,5),1,12),e.addFold("...",new Range(0,1,1,3)),assert.position(e.screenToDocumentPosition(1,2),1,12),e.setUseWrapMode(!0),e.setWrapLimitRange(5,5),assert.position(e.screenToDocumentPosition(4,1),1,12)},"test: wrapLine split function":function(){function e(e,o,n,t){n=n||12,t=t||4,e=lang.stringTrimRight(e);var e=EditSession.prototype.$getDisplayTokens(e),a=EditSession.prototype.$computeWrapSplits(e,n,t);assert.ok(a.length==o.length);for(var s=0;s<a.length;s++)assert.ok(a[s]==o[s])}EditSession.prototype.$wrapAsCode=!0,EditSession.prototype.$indentedSoftWrap=!1,e("foo bar foo bar",[12]),e("foo bar f   bar",[12]),e("foo bar f     r",[12]),e("foo bar foo bar foo bara foo",[12,25]),e("foo foo foo \t \t",[]),e("foooooooooooooo",[12]),e("fooooooooooooooooooooooooooo",[12,24]),e("foo bar fooooooooooobooooooo",[8,20]),e("foo \t\tbar",[6]),e("foo \t \tbar",[7]),e("foo \t \t   \t \t bar",[7]),e("ぁぁ",[1],2),e(" ぁぁ",[1,2],2),e(" ぁ\tぁ",[1,3],2),e(" ぁぁ\tぁ",[2,4],4),e("ぁぁ ぁぁ\tぁ",[3,6],6),e(" ab.c;ef++",[2,4,6,8],2),e(" ab.c;ef++",[3,5,8],3),e(" a.b",[1,2,3],1),e("#>>",[1,2],1),EditSession.prototype.$wrapAsCode=!1,e("ab cde, Juhu kinners",[3,8,13,19],6),EditSession.prototype.$indentedSoftWrap=!0,e("foo bar foo bar foo bara foo",[12,25]),e("fooooooooooooooooooooooooooo",[12,24]),e("\t\tfoo bar fooooooooooobooooooo",[6,10,16,22,28]),e("\t\t\tfoo bar fooooooooooobooooooo",[3,7,11,17,23,29]),e("\tfoo \t \t   \t \t bar",[6,12])},"test get longest line":function(){var e=new EditSession(["12"]);e.setTabSize(4),assert.equal(e.getScreenWidth(),2),e.doc.insertMergedLines({row:0,column:1/0},["",""]),e.doc.insertFullLines(1,["123"]),assert.equal(e.getScreenWidth(),3),e.doc.insertMergedLines({row:0,column:1/0},["",""]),e.doc.insertFullLines(1,["\t\t"]),assert.equal(e.getScreenWidth(),8),e.setTabSize(2),assert.equal(e.getScreenWidth(),4)},"test getDisplayString":function(){var e=new EditSession(["12"]);e.setTabSize(4),assert.equal(e.$getDisplayTokens("\t").length,4),assert.equal(e.$getDisplayTokens("abc").length,3),assert.equal(e.$getDisplayTokens("abc\t").length,4)},"test issue 83":function(){var e=new EditSession(""),o=(new Editor(new MockRenderer,e),e.getDocument());e.setUseWrapMode(!0),o.insertFullLines(0,["a","b"]),o.insertFullLines(2,["c","d"]),o.removeFullLines(1,2)},"test wrapMode init has to create wrapData array":function(){var e=new EditSession("foo bar\nfoo bar");new Editor(new MockRenderer,e);e.setUseWrapMode(!0),e.setWrapLimitRange(3,3),e.adjustWrapLimit(80),assert.equal(e.$wrapData.length,2),assert.equal(e.$wrapData[0].length,1),assert.equal(e.$wrapData[1].length,1)},"test first line blank with wrap":function(){var e=new EditSession("\nfoo");e.setUseWrapMode(!0),assert.equal(e.doc.getValue(),["","foo"].join("\n"))},"test first line blank with wrap 2":function(){var e=new EditSession("");e.setUseWrapMode(!0),e.setValue("\nfoo"),assert.equal(e.doc.getValue(),["","foo"].join("\n"))},"test foldAll":function(){var e=createFoldTestSession(),o=new Editor(new MockRenderer,e),n="  /*\n*comment\n*/\n"+o.getValue()+"\n";o.setValue(n+n,1),o.setOption("mode",new JavaScriptMode),o.execCommand("foldToLevel1"),assert.equal(e.$foldData.length,2),o.execCommand("foldAllComments"),assert.equal(e.$foldData.length,4),o.execCommand("foldall"),assert.equal(e.$foldData.length,4),assert.equal(e.$foldData[1].range.start.row,3),assert.equal(e.$foldData[3].range.start.row,11),o.execCommand("golineup"),o.execCommand("gotolineend"),o.execCommand("unfold"),assert.equal(e.$foldData.length,4),assert.equal(e.$foldData[3].range.start.row,12),o.execCommand("unfoldall"),assert.equal(e.$foldData.length,0)},"test foldOther":function(){var e=new EditSession("{\n\t1{\n\t\t\n\t\t1.1 {\n\t\t}\n\t}\n\t2 {\n\t\t2.1 {\n\t\t\t2.2 {\n\t\t\t}\n\t\t\t2.3 {\n\t\t\t}\n\t\t}\n\t}\n}\n\n{\n}"),o=new Editor(new MockRenderer,e),n=(o.setOption("mode",new JavaScriptMode),o.gotoLine(3,2),o.execCommand("foldOther"),assert.equal(t(),"3,6,16"),o.find("2.2"),assert.equal(t(),"3,8,10,16"),e.unfold());function t(){return e.$foldData.map(function(e){return e.start.row}).join(",")}assert.equal(n.length,4),assert.equal(t(),""),o.session.addFold("xxx",new Range(1,0,7,0)),assert.equal(t(),"1"),o.session.foldAll(),assert.equal(t(),"0,16"),n=o.session.unfold(o.selection.getAllRanges()),assert.equal(n.length,1),assert.equal(t(),"1,8,10,16")},"test fold getFoldDisplayLine":function(){var t=createFoldTestSession();function e(e,o){var n=t.getLine(e.end.row),e=t.getFoldDisplayLine(e,e.end.row,n.length);assert.equal(e,o)}e(t.$foldData[0],"function foo(args...) {"),e(t.$foldData[1],'    for (vfoo...ert(items[bar..."juhu");')},"test foldLine idxToPosition":function(){var a=createFoldTestSession();function e(e,o,n,t){e=a.$foldData[e];assert.position(e.idxToPosition(o),n,t)}e(0,12,0,12),e(0,13,0,13),e(0,14,0,13),e(0,19,0,13),e(0,20,0,18),e(1,10,1,10),e(1,11,1,10),e(1,15,1,10),e(1,16,2,10),e(1,26,2,20),e(1,27,2,20),e(1,32,2,25)},"test fold documentToScreen":function(){var a=createFoldTestSession();function e(e,o,n,t){assert.position(a.documentToScreenPosition(e,o),n,t)}e(0,0,0,0),e(0,13,0,13),e(0,14,0,13),e(0,17,0,13),e(0,18,0,20),e(1,0,1,0),e(1,10,1,10),e(1,11,1,10),e(1,99,1,10),e(2,0,1,10),e(2,9,1,10),e(2,10,1,16),e(2,11,1,17),e(2,19,1,25),e(2,20,1,26),e(2,21,1,26),e(2,24,1,26),e(2,25,1,32),e(2,26,1,33),e(2,99,1,40),e(3,0,2,0)},"test fold screenToDocument":function(){var a=createFoldTestSession();function e(e,o,n,t){assert.position(a.screenToDocumentPosition(n,t),e,o)}e(0,0,0,0),e(0,13,0,13),e(0,13,0,14),e(0,18,0,20),e(0,19,0,21),e(1,0,1,0),e(1,10,1,10),e(1,10,1,11),e(1,10,1,15),e(2,10,1,16),e(2,11,1,17),e(2,19,1,25),e(2,20,1,26),e(2,20,1,27),e(2,20,1,31),e(2,25,1,32),e(2,26,1,33),e(2,33,1,99),e(3,0,2,0)},"test getFoldsInRange()":function(){var i=createFoldTestSession(),e=i.$foldData,e=e[0].folds.concat(e[1].folds);function o(e,o,n,t,a){var e=new Range(e,o,n,t),s=i.getFoldsInRange(e);assert.ok(s.length==a.length);for(var r=0;r<s.length;r++)assert.equal(s[r].range+"",a[r].range+"")}o(0,0,0,13,[]),o(0,0,0,14,[e[0]]),o(0,0,0,18,[e[0]]),o(0,0,1,10,[e[0]]),o(0,0,1,11,[e[0],e[1]]),o(0,18,1,11,[e[1]]),o(2,0,2,13,[e[1]]),o(2,10,2,20,[]),o(2,10,2,11,[]),o(2,19,2,20,[])},"test fold one-line text insert":function(){var e,o,n,t=createFoldTestSession(),a=t.getUndoManager(),s=t.$foldData;function r(e,o,n){t.insert({row:e,column:o},n),t.$syncInformUndoManager()}o=(e=t.$foldData[0]).folds[0],r(0,0,"0"),assert.range(e.range,0,14,0,19),assert.range(o.range,0,14,0,19),r(0,14,"1"),assert.range(e.range,0,15,0,20),assert.range(o.range,0,15,0,20),r(0,20,"2"),assert.range(e.range,0,15,0,20),assert.range(o.range,0,15,0,20),n=(e=t.$foldData[1]).folds,r(1,0,"3"),assert.range(e.range,1,11,2,25),assert.range(n[0].range,1,11,2,10),assert.range(n[1].range,2,20,2,25),r(1,11,"4"),assert.range(e.range,1,12,2,25),assert.range(n[0].range,1,12,2,10),assert.range(n[1].range,2,20,2,25),r(2,10,"5"),assert.range(e.range,1,12,2,26),assert.range(n[0].range,1,12,2,10),assert.range(n[1].range,2,21,2,26),r(2,21,"6"),assert.range(e.range,1,12,2,27),assert.range(n[0].range,1,12,2,10),assert.range(n[1].range,2,22,2,27),r(2,27,"7"),assert.range(e.range,1,12,2,27),assert.range(n[0].range,1,12,2,10),assert.range(n[1].range,2,22,2,27),a.undo(),assert.range(e.range,1,12,2,27),assert.range(n[0].range,1,12,2,10),assert.range(n[1].range,2,22,2,27),a.undo(),assert.range(e.range,1,12,2,26),assert.range(n[0].range,1,12,2,10),assert.range(n[1].range,2,21,2,26),a.undo(),assert.range(e.range,1,12,2,25),assert.range(n[0].range,1,12,2,10),assert.range(n[1].range,2,20,2,25),a.undo(),assert.range(e.range,1,11,2,25),assert.range(n[0].range,1,11,2,10),assert.range(n[1].range,2,20,2,25),a.undo(),assert.equal(s.length,2),assert.range(s[0].range,0,15,0,20),assert.range(s[1].range,1,10,2,25),o=(e=t.$foldData[0]).folds[0],a.undo(),assert.range(e.range,0,15,0,20),assert.range(o.range,0,15,0,20),a.undo(),assert.range(e.range,0,14,0,19),assert.range(o.range,0,14,0,19),a.undo(),assert.range(e.range,0,13,0,18),assert.range(o.range,0,13,0,18)},"test fold multi-line insert/remove":function(){var t=createFoldTestSession(),e=t.getUndoManager();t.$foldData;function o(e,o,n){t.insert({row:e,column:o},n),t.$syncInformUndoManager()}var n=t.$foldData;o(0,0,"\nfo0"),assert.equal(n.length,2),assert.range(n[0].range,1,16,1,21),assert.range(n[1].range,2,10,3,25),o(2,0,"\nba1"),assert.equal(n.length,2),assert.range(n[0].range,1,16,1,21),assert.range(n[1].range,3,13,4,25),o(3,10,"\nfo2"),assert.equal(n.length,2),assert.range(n[0].range,1,16,1,21),assert.range(n[1].range,4,6,5,25),o(5,10,"\nba3"),assert.equal(n.length,3),assert.range(n[0].range,1,16,1,21),assert.range(n[1].range,4,6,5,10),assert.range(n[2].range,6,13,6,18),o(6,18,"\nfo4"),assert.equal(n.length,3),assert.range(n[0].range,1,16,1,21),assert.range(n[1].range,4,6,5,10),assert.range(n[2].range,6,13,6,18),e.undo(),assert.equal(n.length,3),assert.range(n[0].range,1,16,1,21),assert.range(n[1].range,4,6,5,10),assert.range(n[2].range,6,13,6,18),e.undo(),assert.equal(n.length,2),assert.range(n[0].range,1,16,1,21),assert.range(n[1].range,4,6,5,25),e.undo(),assert.equal(n.length,2),assert.range(n[0].range,1,16,1,21),assert.range(n[1].range,3,13,4,25),e.undo(),assert.equal(n.length,2),assert.range(n[0].range,1,16,1,21),assert.range(n[1].range,2,10,3,25),e.undo(),assert.equal(n.length,2),assert.range(n[0].range,0,13,0,18),assert.range(n[1].range,1,10,2,25)},"test fold wrap data compution":function(){function s(e,o,n){e&&assertArray(t[0],e),o&&assertArray(t[1],o),n&&assertArray(t[2],n)}function e(e,o,n,t,a){r.removeFold(r.getFoldAt(e,o)),s(n,t,a)}var r=new EditSession(["foo bar foo bar","foo bar foo bar","foo bar foo bar"].join("\n")),t=(r.setUseWrapMode(!0),r.$wrapLimit=7,r.$updateWrapData(0,2),r.$wrapData);return s([8],[8],[8]),r.addFold("woot",new Range(0,4,0,15)),s([4],[8],[8]),e(0,4,[8],[8],[8]),r.addFold("woot",new Range(0,6,0,9)),s([6,13],[8],[8]),e(0,6,[8],[8],[8]),r.addFold("woot",new Range(0,3,0,15)),s([],[8],[8]),e(0,4,[8],[8],[8]),r.addFold("woot",new Range(0,8,0,15)),s([8],[8],[8]),e(0,8,[8],[8],[8]),r.addFold("woot0123456789",new Range(0,8,0,15)),s([8],[8],[8]),e(0,8,[8],[8],[8]),r.addFold("woot0123456789",new Range(0,6,0,8)),s([6,20],[8],[8]),e(0,8,[8],[8],[8]),r.addFold("woot0123456789",new Range(0,6,0,8)),r.addFold("woot0123456789",new Range(0,8,0,10)),s([6,20,34],[8],[8]),r.removeFold(r.getFoldAt(0,7)),e(0,8,[8],[8],[8]),r.addFold("woot0123456789",new Range(0,7,0,9)),r.addFold("woot0123456789",new Range(0,13,0,15)),s([7,21,25],[8],[8]),r.removeFold(r.getFoldAt(0,7)),e(0,14,[8],[8],[8]),r.addFold("woot",new Range(0,8,1,15)),s([8],[8],[8]),e(0,8,[8],[8],[8]),r.addFold("woot",new Range(0,9,1,11)),s([8,14],[8],[8]),e(0,9,[8],[8],[8]),r.addFold("woot",new Range(0,9,1,15)),s([8],[8],[8]),e(0,9,[8],[8],[8]),r},"test delete fold with wrap enabled":function(){var e=new EditSession("");e.setValue(["This is some placeholder text that will be folded inline.","This is some placeholder text that will be folded inline.","More text.","<p>The cursor in this paragraph text will be offset by 1 row.<p>","<p>Everything after this will be offset as well due to the folds in the row before too.</p>"].join("\n")),e.addFold("...",new Range(0,8,0,42)),e.addFold("...",new Range(1,8,1,42)),e.addFold("...",new Range(3,7,3,51)),e.setOption("wrap",40),e.remove(new Range(0,0,2,5)),e.adjustWrapLimit(80),assert.equal(e.$wrapData+"",[[],[],[40,76]]+"")},"test add fold":function(){var n,t=createFoldTestSession();function e(e,o){n=t.addFold(e,o)}e("foo",new Range(0,13,0,17)),e("foo",new Range(0,14,0,18)),e("foo",new Range(0,13,0,18)),assert.equal(t.$foldData[0].folds.length,1),e("f",new Range(0,13,0,18)),e("foo",new Range(0,18,0,21)),assert.equal(t.$foldData[0].folds.length,2),t.removeFold(n),e("foo",new Range(0,18,0,22)),e("foo",new Range(0,18,0,19)),e("foo",new Range(0,22,1,10)),t.unfold(),e("x",new Range(1,9,3,15)),e("x",new Range(2,9,2,15)),e("x",new Range(2,10,2,18)),e("x",new Range(2,10,2,18)),e("x",new Range(2,25,2,27)),e("x",new Range(2,28,2,30)),e("x",new Range(2,7,2,29));var o=t.getFoldsInRange(new Range(0,0,100,100));assert.equal(o.length,1),t.expandFolds(o),o=t.getFoldsInRange(new Range(0,0,100,100)),assert.equal(o.length,1),t.expandFolds(o),o=t.getFoldsInRange(new Range(0,0,100,100)),assert.equal(o.length,2),t.expandFolds(o),o=t.getFoldsInRange(new Range(0,0,100,100)),assert.equal(o.length,0)},"test add subfolds":function(){var e=createFoldTestSession(),o=e.$foldData,n=o[0].folds[0],t=e.addFold("fold0",new Range(0,10,0,21));assert.equal(o[0].folds.length,1),assert.equal(t.subFolds.length,1),assert.equal(t.subFolds[0],n),e.expandFold(t),assert.equal(o[0].folds.length,1),assert.equal(o[0].folds[0],n),assert.equal(t.subFolds.length,0),t=e.addFold("fold0",new Range(0,13,2,10)),assert.equal(o.length,1),assert.equal(t.subFolds.length,2),assert.equal(t.subFolds[0],n),e.expandFold(t),assert.equal(o.length,2),assert.equal(o[0].folds.length,1),assert.equal(o[0].folds[0],n),assert.equal(t.subFolds.length,0),e.unfold(null,!0),t=e.addFold("fold0",new Range(0,0,0,21)),e.addFold("fold0",new Range(0,1,0,5)),e.addFold("fold0",new Range(0,6,0,8)),assert.equal(t.subFolds.length,2)},"test row cache":function(){var e=createFoldTestSession(),o=(e.screenToDocumentPosition(2,3),assertArray(e.$docRowCache,[1,3]),assertArray(e.$screenRowCache,[1,2]),e.screenToDocumentPosition(5,3),assertArray(e.$docRowCache,[1,3,4]),assertArray(e.$screenRowCache,[1,2,3]),e.screenToDocumentPosition(0,3),assertArray(e.$docRowCache,[1,3,4]),assertArray(e.$screenRowCache,[1,2,3]),e.screenToDocumentPosition(0,0));assert.equal(o.row,0),assertArray(e.$docRowCache,[1,3,4]),assertArray(e.$screenRowCache,[1,2,3]),e.screenToDocumentPosition(1,0),assertArray(e.$docRowCache,[1,3,4]),assertArray(e.$screenRowCache,[1,2,3]),e.$resetRowCache(),assertArray(e.$docRowCache,[]),assertArray(e.$screenRowCache,[]),e.screenToDocumentPosition(1,3),assertArray(e.$docRowCache,[1]),assertArray(e.$screenRowCache,[1]),e.screenToDocumentPosition(5,3),assertArray(e.$docRowCache,[1,3,4]),assertArray(e.$screenRowCache,[1,2,3]),(e=new EditSession(new Array(30).join("\n"))).documentToScreenPosition(2,0),e.documentToScreenPosition(2,0),assertArray(e.$docRowCache,[1,2]),assertArray(e.$screenRowCache,[1,2])},"test annotations":function(){var e=new EditSession([]),o={row:0,type:"info",text:"This is a test."};e.clearAnnotations(),assertArray(e.getAnnotations(),[]),e.setAnnotations([o]),assertArray(e.getAnnotations(),[o])},"test: mode loading":function(o){var n;require.undef?((n=new EditSession([])).setMode("ace/mode/javascript"),assert.equal(n.$modeid,"ace/mode/javascript"),n.on("changeMode",function(){assert.equal(n.$modeid,"ace/mode/javascript")}),n.setMode("ace/mode/sh",function(e){assert.ok(!e)}),setTimeout(function(){n.setMode("ace/mode/javascript",function(e){n.setMode("ace/mode/javascript"),assert.equal(n.$modeid,"ace/mode/javascript"),o()})},0)):(console.log("Skipping test: This test only runs in the browser"),o())},"test: sets destroyed flag when destroy called and tokenizer is never null":function(){var e=new EditSession(["foo bar foo bar"]);assert.notEqual(e.bgTokenizer,null),assert.equal(e.destroyed,!1),e.destroy(),assert.equal(e.destroyed,!0),assert.notEqual(e.bgTokenizer,null)}},"undefined"!=typeof module&&module===require.main&&require("asyncjs").test.testcase(module.exports).exec();