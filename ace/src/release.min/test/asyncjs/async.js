var STOP=exports.STOP={},makeAsync=(exports.Generator=function(t){this.source="function"==typeof t?{next:t}:t},!function(){this.next=function(t){this.source.next(t)},this.map=function(i){if(!i)return this;i=makeAsync(1,i);var t=this.source;return this.next=function(r){t.next(function(t,n){t?r(t):i(n,function(t,n){t?r(t):r(null,n)})})},new this.constructor(this)},this.filter=function(n){if(!n)return this;n=makeAsync(1,n);var o=this.source;return this.next=function(e){o.next(function r(t,i){t?e(t):n(i,function(t,n){t?e(t):n?e(null,i):o.next(r)})})},new this.constructor(this)},this.slice=function(e,o){var u=-1,s=((!o||o<0)&&(o=1/0),this.source);return this.next=function(i){s.next(function t(n,r){u++,n?i(n):e<=u&&u<o?i(null,r):o<=u?i(STOP):s.next(t)})},new this.constructor(this)},this.reduce=function(e,t){e=makeAsync(3,e);var o=0,u=!1,s=t,c=this.source;return this.next=function(i){if(u)return i(STOP);function r(){c.next(function r(t,n){if(t)return u=!0,t==STOP?i(null,s):t;e(s,n,o++,function(t,n){s=n,c.next(r)})})}void 0===t?c.next(function(t,n){if(t)return i(t,s);s=n,r()}):r()},new this.constructor(this)},this.forEach=this.each=function(i){i=makeAsync(1,i);var t=this.source;return this.next=function(r){t.next(function(t,n){t?r(t):i(n,function(t){r(t,n)})})},new this.constructor(this)},this.some=function(e){e=makeAsync(1,e);var o=this.source,u=!1;return this.next=function(i){if(u)return i(STOP);o.next(function r(t,n){if(t)return i(t);e(n,function(t,n){t?(u=!0,t==STOP?i(null,!1):i(t)):n?i(null,u=!0):o.next(r)})})},new this.constructor(this)},this.every=function(e){e=makeAsync(1,e);var o=this.source,u=!1;return this.next=function(i){if(u)return i(STOP);o.next(function r(t,n){if(t)return i(t);e(n,function(t,n){t?(u=!0,t==STOP?i(null,!0):i(t)):n?o.next(r):i(null,!(u=!0))})})},new this.constructor(this)},this.call=function(n){this.source;return this.map(function(t,r){(t=makeAsync(0,t,n)).call(n,function(t,n){r(t,n)})})},this.concat=function(t){var e=[this],o=(e.push.apply(e,arguments),0),u=e[o++];return new this.constructor(function(i){u.next(function t(n,r){return n?n==STOP?(u=e[o++])?u.next(t):i(STOP):i(n):i(null,r)})})},this.zip=function(t){var n=[this];return n.push.apply(n,arguments),new this.constructor(function(t){exports.list(n).map(function(t,n){t.next(n)}).toArray(t)})},this.expand=function(e,t){var n,o;return e?(e=makeAsync(1,e),t=t||this.constructor,n=this.source,o=null,new t(function r(i){o?o.next(function(t,n){return t==STOP?(o=null,r(i)):t?i(t):void i(t,n)}):n.next(function(t,n){if(t)return i(t);e(n,function(t,n){if(t)return i(t);o=n,r(i)})})})):this},this.sort=function(i){var e,t=this;return this.next=function(r){if(e)return e.next(r);t.toArray(function(t,n){t?r(t):(e=exports.list(n.sort(i))).next(r)})},new this.constructor(this)},this.join=function(t){return this.$arrayOp(Array.prototype.join,void 0!==t?[t]:null)},this.reverse=function(){return this.$arrayOp(Array.prototype.reverse)},this.$arrayOp=function(i,e){var t=this,n=0;return this.next=function(r){if(0<n++)return r(STOP);t.toArray(function(t,n){t?r(t,""):r(null,e?i.apply(n,e):i.call(n))})},new this.constructor(this)},this.end=function(i,e){e||(e=arguments[0],i=!0);var o,u,s=this.source;s.next(function t(n,r){n?n==STOP?e&&e(u,o):i?e&&e(n,r):(u=n,s.next(t)):(o=r,s.next(t))})},this.toArray=function(i,e){e||(e=arguments[0],i=!0);var o=[],u=[],s=this.source;s.next(function t(n,r){if(n){if(n==STOP)return i?e(null,o):(u.length=o.length,e(u,o));if(i)return e(n);u[o.length]=n}o.push(r),s.next(t)})}}.call(exports.Generator.prototype),exports.makeAsync=function(r,i,e){return i.length>r?i:function(){var t,n=arguments[r];try{t=i.apply(e||this,arguments)}catch(t){return n(t)}n(null,t)}});exports.list=function(n,t){var t=t||exports.Generator,r=0,i=n.length;return new t(function(t){r<i?t(null,n[r++]):t(STOP)})},exports.values=function(t,n){var r,i=[];for(r in t)i.push(t[r]);return exports.list(i,n)},exports.keys=function(t,n){var r,i=[];for(r in t)i.push(r);return exports.list(i,n)},exports.range=function(t,r,i,n){var n=n||exports.Generator,e=(i=i||1,null==r&&(r=0<i?1/0:-1/0),t=t||0);return new n(function(t){var n;0<i&&r<=e||i<0&&e<=r?t(STOP):(n=e,e+=i,t(null,n))})},exports.concat=function(t,n){return 1<arguments.length?t.concat.apply(t,Array.prototype.slice.call(arguments,1)):t},exports.zip=function(t,n){return 1<arguments.length?t.zip.apply(t,Array.prototype.slice.call(arguments,1)):t.map(function(t,n){n(null,[t])})},exports.plugin=function(t,n){if(t)for(var r in t)exports.Generator.prototype[r]=t[r];if(n)for(var r in n)exports[r]=n[r]};