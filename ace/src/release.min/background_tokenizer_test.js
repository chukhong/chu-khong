"undefined"!=typeof process&&require("amd-loader");var EditSession=require("./edit_session").EditSession,JavaScriptMode=require("./mode/javascript").Mode,LuaMode=require("./mode/lua").Mode,Range=require("./range").Range,assert=require("./test/assertions");function forceTokenize(e,t){for(var n=t||0,s=e.getLength();n<s;n++)e.getTokens(n)}function testStates(e,t){for(var n=0,s=e.getLength();n<s;n++)assert.equal(e.bgTokenizer.states[n],t[n]);assert.ok(s==t.length)}module.exports={"test background tokenizer update on session change":function(){var e=new EditSession(["/*","*/","var juhu"]);e.setMode("./mode/javascript"),forceTokenize(e),testStates(e,["comment1","start","no_regex"]),e.remove(new Range(0,2,1,2)),testStates(e,[null,"no_regex"]),forceTokenize(e),testStates(e,["comment1","comment1"]),e.insert({row:0,column:2},"\n*/"),testStates(e,[void 0,void 0,"comment1"]),forceTokenize(e),testStates(e,["comment1","start","no_regex"])},"test background tokenizer sends update event":function(){var n=new EditSession(["/*","var","juhu","*/"]),s=(n.setMode("./mode/javascript"),null);function e(e,t){assert.ok(!s,"unneccessary update event"),n.bgTokenizer.running=1,n.bgTokenizer.$worker(),assert.ok(s),assert.equal([e,t]+"",[s.first,s.last]+""),s=null}n.bgTokenizer.on("update",function(e){s=e.data}),forceTokenize(n);var t="comment1";testStates(n,[t,t,t,"start"]),n.remove(new Range(0,0,0,2)),testStates(n,[t,t,t,"start"]),e(0,3),testStates(n,["start","no_regex","no_regex","regex"]),n.insert({row:0,column:0},"/*"),n.getTokens(0),n.getTokens(1),n.getTokens(2),e(0,3),forceTokenize(n),testStates(n,[t,t,t,"start"])},"test background tokenizer sends update event 2":function(t){var n=new EditSession(["-[[","juhu","kinners]]--",""]),e=(n.setMode("./mode/lua"),forceTokenize(n),"bracketedString,2,start"),s="bracketedComment,2,start";testStates(n,[e,e,"start","start"]),n.insert({row:0,column:0},"-"),forceTokenize(n),n.bgTokenizer.once("update",function(e){assert.equal([0,4]+"",[e.data.first,e.data.last]+""),testStates(n,[s,s,"start","start"]),t()}),n.bgTokenizer.running=1,n.bgTokenizer.$worker()}},"undefined"!=typeof module&&module===require.main&&require("asyncjs").test.testcase(module.exports).exec();