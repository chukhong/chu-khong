"use strict";!function(){var r;console.log("[load] register-sw"),window.addEventListener("load",async()=>{"1"==localStorage.getItem("app.loadNewVersion")&&(localStorage.setItem("app.loadNewVersion",2),window.location.reload());var a=document.querySelector("#appversion");"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js").then(function(n){r=e=>{n.update(),window.confirm(`Đã có phiên bản mới ${app.newVersion} bạn nên cài đặt lại để được thừa hưởng các tính năng mới! OK để làm mới?`)&&(n.unregister(),e&&e(),localStorage.setItem("app.loadNewVersion",1),window.location.reload())};var e,o=localStorage.getItem("app.version");navigator.onLine&&(console.log("[sw-regiser] load here"),e=Math.floor(1e4*Math.random())+1,fetch("/chu-khong/js2/version.json?v="+e,{method:"GET",headers:{"Content-Type":"application/json;charset=utf-8"}}).then(e=>e.json()).then(async e=>{null==o&&(localStorage.setItem("app.version",e.newVersion),o=e.newVersion),app.newVersion=e.newVersion,a&&(a.innerHTML="Chu Khong Version: "+e.newVersion),o!=app.newVersion&&window.caches&&((await caches.keys()).forEach(async e=>{await caches.delete(e)}),r(()=>{localStorage.setItem("app.version",e.newVersion)}))}).catch(e=>{}))})})}();