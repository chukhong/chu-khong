!function(r){function h(r,t){t<0&&(t=r.length+t),out=0;for(var n=t;n<t+4;n++)out=(out<<=8)|255&r[n];return out}n=new TextDecoder("utf-8");var n,v=function(r){return n.decode(r)};function p(r,t,n){var e;return void 0===t&&(t=0),void 0===n&&(n=-1),".dz"==r.name.substr(-3)?(e=new DictZipFile(r,pako.inflateRaw),0<=n?e.read(t,n):e.read(t)):(e=new FileReaderSync,0<=n?e.readAsArrayBuffer(r.slice(t,t+n)):e.readAsArrayBuffer(r.slice(t)))}function i(r,t,n){r=p(r,t,n);return v(new Uint8Array(r))}r.StarDict=function(r){var y={},u={version:"",bookname:"",wordcount:"",synwordcount:"0",idxfilesize:"",sametypesequence:""};var e=r;if(["idx","idx.oft","syn","syn.oft","dict","ifo","rifo","ridx","rdic"].forEach(function(r){y[r]=null;for(var t=0;t<e.length;t++){var n=e[t].name;n.substr(-1-r.length)!="."+r&&n.substr(-4-r.length)!="."+r+".dz"||(y[r]=e[t],e.splice(t,1))}}),y.res=e,null==y.dict)throw new Error("Missing *.dict(.dz) file!");if(null==y.idx)throw new Error("Missing *.idx(.dz) file!");if(null==y.ifo)throw new Error("Missing *.ifo(.dz) file!");r=i(y.ifo);if("StarDict's dict ifo file"!=(r=r.split(/\r\n|\n/g)).shift())throw new Error("Not a proper ifo file");if(r.forEach(function(r){"synwordcount"==(w=r.split("="))[0]&&null==y.syn&&(w[1]=0),u[w[0]]=w[1]}),null!=y.rifo){r=i(y.rifo);if("StarDict's storage ifo file"!=(r=r.split("\n")).shift())throw new Error("Not a proper rifo file");r.forEach(function(r){w=r.split("="),console.log("rifo: "+w[0]+"="+w[1])})}this.keyword=function(r){return u[r]},this.resource=function(e){e=e.replace(/^\x1E/,"").replace(/\x1F$/,"");var r=function(){for(var r=0;r<y.res.length;r++){var t=y.res[r].name;if(e==t.substring(t.lastIndexOf("/")+1))return y.res[r]}return null}();return null!=r?r:null==y.ridx?null:null!=(r=function(r){for(var t=new Uint8Array(r),n=0;n<t.length;n++)if(v(t.subarray(0,n))==e)return[h(t,n+1),h(t,n+5)];return null}(p(y.ridx)))?new Blob([p(y.rdic,r[0],r[1])]):void 0},this.entry=function(r){var n=r[0],r=r[1];var n=p(y.dict,n,r),e=new Uint8Array(n),i=[],o=!1;for(""!=u.sametypesequence&&(type_str=u.sametypesequence,o=!0);;){if(o?(t=type_str[0],type_str=type_str.substr(1)):(t=String.fromCharCode(e[0]),e=e.subarray(1)),o&&""==type_str)d=e;else if(t==t.toUpperCase()){var s=getUIntAt(e,0);d=e.subarray(4,s+4),e=e.subarray(s+4)}else{for(s=0;0!=e[s];)s++;d=e.subarray(0,s),e=e.subarray(s+1)}if(-1!="mgtxykwh".indexOf(t)&&(d=v(d)),i.push({type:t,content:d}),0==e.length||o&&""==type_str)break}return i},this.synonyms=function(d){if(null==y.syn)return[];void 0===d&&(d={});var r,t={count:-1,start_offset:0,include_term:!0,include_wid:!0,include_offset:!1};for(r in t)void 0===d[r]&&("count"==r&&void 0!==d.start_offset?d.count=1:d[r]=t[r]);return d.count<0&&(d.count=parseInt(this.keyword("synwordcount"))),function r(t,n,e){if(n<=0||y.syn.size<=t)return[];for(var i,o,s,u=p(y.syn,t,n*(e=void 0===e?25:e)),f=new Uint8Array(u),a=[],c=0,l=0;l<f.length-4&&a.length<n;l++)0==f[l]&&(a.push((i=f.subarray(c,l+5),o=t+c,s={},d.include_term&&(s.term=v(i.subarray(0,-5))),d.include_wid&&(s.wid=h(i,-4)),d.include_offset&&(s.offset=o),s)),c=l+=5);return a.concat(r(t+c,n-a.length,e+25))}(d.start_offset,d.count)},this.index=function(d){void 0===d&&(d={});var r,t={count:-1,start_offset:0,include_term:!0,include_dictpos:!0,include_offset:!1};for(r in t)void 0===d[r]&&("count"==r&&void 0!==d.start_offset?d.count=1:d[r]=t[r]);d.count<0&&(d.count=parseInt(this.keyword("wordcount")));return function r(t,n,e){if(n<=0||y.idx.size<=t)return[];for(var i,o,s,u=p(y.idx,t,n*(e=void 0===e?25:e)),f=new Uint8Array(u),a=[],c=0,l=0;l<f.length-8&&a.length<n;l++)0==f[l]&&(a.push((i=f.subarray(c,l+9),o=t+c,s={},d.include_term&&(s.term=v(i.subarray(0,-9))),d.include_dictpos&&(s.dictpos=[h(i,-8),h(i,-4)]),d.include_offset&&(s.offset=o),s)),c=l+=9);return a.concat(r(t+c,n-a.length,e+25))}(d.start_offset,d.count)},this.oft=function(r){var t,n=("synonyms"==(r=void 0===r?"index":r)?"syn":"idx")+".oft",e=parseInt(this.keyword(("synonyms"==r?"syn":"")+"wordcount"));if(null==y[n]){for(var i=this.iterable(r),o=i.next(),s=0,u=new Uint32Array(e);null!=o;)u[s++]=o,o=i.next();t=u.buffer}else t=p(y[n]);return t},this.iterable=function(o){function r(i){return new function(){var e=0;function t(r){for(var t=r;t<i.length;t++)if(0==i[t])return t;return-1}this.data=function(r){return"synonyms"==o?h(i,t(r)+1):[h(i,t(r)+1),h(i,t(r)+5)]},this.term=function(r){return v(i.subarray(r,t(r)))},this.next=function(){for(var r=e,t=null,n="synonyms"==o?4:8;e<i.length;e++)if(0==i[e]){t=r,e+=1+n;break}return t},this.view=i}}var t="synonyms"==(o=void 0===o?"index":o)?"syn":"idx";return null==y[t]?r([]):(t=p(y[t]),r(new Uint8Array(t)))}}}(this);