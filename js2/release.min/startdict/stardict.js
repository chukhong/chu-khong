!function(n){function y(n,t){t<0&&(t=n.length+t),out=0;for(var r=t;r<t+4;r++)out=(out<<=8)|255&n[r];return out}r=new TextDecoder("utf-8");var r,v=function(n){return r.decode(n)};function s(r,e,i){var o;return void 0===e&&(e=0),void 0===i&&(i=-1),".dz"==r.name.substr(-3)?(o=new DictZipFile(r,pako.inflateRaw),0<=i?o.read(e,i):o.read(e)):(o=new FileReader,new Promise(function(t,n){0<=i?o.readAsArrayBuffer(r.slice(e,e+i)):o.readAsArrayBuffer(r.slice(e)),o.onload=function(n){t(n.target.result)}}))}function o(n,t,r){return s(n,t,r).then(function(n){return v(new Uint8Array(n))})}n.StarDict=function(){var i={},u={version:"",bookname:"",wordcount:"",synwordcount:"",idxfilesize:"",sametypesequence:""};this.load=function(n){return new Promise(function(t,r){try{var e=n;if(["idx","syn","dict","ifo","rifo","ridx","rdic"].forEach(function(n){i[n]=null;for(var t=0;t<e.length;t++){var r=e[t].name;r.substr(-1-n.length)!="."+n&&r.substr(-4-n.length)!="."+n+".dz"||(i[n]=e[t],e.splice(t,1))}}),i.res=e,null==i.dict)throw new Error("Missing *.dict(.dz) file!");if(null==i.idx)throw new Error("Missing *.idx(.dz) file!");if(null==i.ifo)throw new Error("Missing *.ifo(.dz) file!");o(i.ifo).then(function(n){if("StarDict's dict ifo file"!=(n=n.split("\n")).shift())throw new Error("Not a proper ifo file");n.forEach(function(n){"synwordcount"==(w=n.split("="))[0]&&null==i.syn&&(w[1]=0),u[w[0]]=w[1]}),null!=i.rifo?o(i.rifo).then(function(n){if("StarDict's storage ifo file"!=(n=n.split("\n")).shift())throw new Error("Not a proper rifo file");n.forEach(function(n){w=n.split("="),console.log("rifo: "+w[0]+"="+w[1])}),t()}):t()})}catch(n){r(n)}})},this.keyword=function(n){return u[n]},this.resource=function(e){return e=e.replace(/^\x1E/,"").replace(/\x1F$/,""),new Promise(function(t,n){var r=function(){for(var n=0;n<i.res.length;n++){var t=i.res[n].name;if(e==t.substring(t.lastIndexOf("/")+1))return i.res[n]}return null}();null!=r?t(r):null!=i.ridx?s(i.ridx).then(function(n){n=function(n){for(var t=new Uint8Array(n),r=0;r<t.length;r++)if(v(t.subarray(0,r))==e)return[y(t,r+1),y(t,r+5)];return null}(n);null!=n?s(i.rdic,n[0],n[1]).then(function(n){t(new Blob([n]))}):t(null)}):t(null)})},this.entry=function(n){var r=n[0],n=n[1];return s(i.dict,r,n).then(function(n){var r=new Uint8Array(n),e=[],i=!1;for(""!=u.sametypesequence&&(type_str=u.sametypesequence,i=!0);;){if(i?(t=type_str[0],type_str=type_str.substr(1)):(t=String.fromCharCode(r[0]),r=r.subarray(1)),i&&""==type_str)d=r;else if(t==t.toUpperCase()){var o=getUIntAt(r,0);d=r.subarray(4,o+4),r=r.subarray(o+4)}else{for(o=0;0!=r[o];)o++;d=r.subarray(0,o),r=r.subarray(o+1)}if(-1!="mgtxykwh".indexOf(t)&&(d=v(d)),e.push({type:t,content:d}),0==r.length||i&&""==type_str)break}return e})},this.synonyms=function(h){if(null==i.syn)return[];void 0===h&&(h={});var n,t={count:-1,start_offset:0,include_term:!0,include_wid:!0,include_offset:!1};for(n in t)void 0===h[n]&&("count"==n&&void 0!==h.start_offset?h.count=1:h[n]=t[n]);return h.count<0&&(h.count=parseInt(this.keyword("synwordcount"))),function c(a,l,d){return void 0===d&&(d=25),new Promise(function(f,n){var t;l<=0||i.syn.size<=a?f([]):(t=l*d,s(i.syn,a,t).then(function(n){for(var t,r,e,i=new Uint8Array(n),o=[],u=0,s=0;s<i.length&&o.length<l;s++)0==i[s]&&(o.push((t=i.subarray(u,s+5),r=a+u,e={},h.include_term&&(e.term=v(t.subarray(0,-5))),h.include_wid&&(e.wid=y(t,-4)),h.include_offset&&(e.offset=r),e)),u=s+=5);c(a+u,l-o.length,d+25).then(function(n){f(o.concat(n))})}))})}(h.start_offset,h.count)},this.index=function(h){void 0===h&&(h={});var n,t={count:-1,start_offset:0,include_term:!0,include_dictpos:!0,include_offset:!1};for(n in t)void 0===h[n]&&("count"==n&&void 0!==h.start_offset?h.count=1:h[n]=t[n]);return h.count<0&&(h.count=parseInt(this.keyword("wordcount"))),function c(a,l,d){return void 0===d&&(d=25),new Promise(function(f,n){var t;l<=0||i.idx.size<=a?f([]):(t=l*d,s(i.idx,a,t).then(function(n){for(var t,r,e,i=new Uint8Array(n),o=[],u=0,s=0;s<i.length-8&&o.length<l;s++)0==i[s]&&(o.push((t=i.subarray(u,s+9),r=a+u,e={},h.include_term&&(e.term=v(t.subarray(0,-9))),h.include_dictpos&&(e.dictpos=[y(t,-8),y(t,-4)]),h.include_offset&&(e.offset=r),e)),u=s+=9);c(a+u,l-o.length,d+25).then(function(n){f(o.concat(n))})}))})}(h.start_offset,h.count)},this.oft=function(t){var n=("synonyms"==(t=void 0===t?"index":t)?"syn":"idx")+".oft",o=parseInt(this.keyword(("synonyms"==t?"syn":"")+"wordcount"));return null==i[n]?new Promise(function(i,n){this.iterable(t).then(function(n){for(var t=n.next(),r=0,e=new Uint32Array(o);null!=t;)e[r++]=t,t=n.next();i(e.buffer)})}):s(i[n])},this.iterable=function(o){function r(i){return new function(){var e=0;function t(n){for(var t=n;t<i.length;t++)if(0==i[t])return t;return-1}this.data=function(n){return"synonyms"==o?y(i,t(n)+1):[y(i,t(n)+1),y(i,t(n)+5)]},this.term=function(n){return v(i.subarray(n,t(n)))},this.next=function(){for(var n=e,t=null,r="synonyms"==o?4:8;e<i.length;e++)if(0==i[e]){t=n,e+=1+r;break}return t},this.view=i}}var e="synonyms"==(o=void 0===o?"index":o)?"syn":"idx";return new Promise(function(t,n){null==i[e]?t(r([])):s(i[e]).then(function(n){t(r(new Uint8Array(n)))})})}}}(this);