var bufferTable;!function(){var t,n=0;function a(e,n=0,a=100){e.map((e,t)=>{n<=t&&t<n+a&&(t=d.create("li",{},words),d.create("a",{href:"#","data-dictpos":JSON.stringify(e.dictpos),"data-offset":e.offset,innerText:e.term},t).onclick=r)})}function r(e){e.preventDefault();e=e.target,e=JSON.parse(e.dataset.dictpos);return o.postMessage({fn:"findMeaning",data:{dictpos:e,target:t}}),!1}words.onscroll=function(){words.scrollTop+words.offsetHeight+1>=words.scrollHeight&&(a(bufferTable,n,100),n+100<bufferTable.length)&&(n+=100)},loadStardict.onchange=function(e){e.preventDefault(),l=[];for(var t=e.target.files,n=0;n<t.length;n++)l.push(t[n]);o.postMessage({fn:"loadList",data:l})};var l=[];function i(e){e={name:e.target.innerText.trim()};t=e.name.replace(/\W/g,""),e&&(d.id("words").innerHTML="",n=0,dictStatus.style.display="block",o.postMessage({fn:"loadWordList",data:e}))}var o=new Worker("jszip-worker.js"),s={builtDataFromJszip:function(e){var t=d.create("h4",{}),n=e.fileName.replace(/\W/g,""),a=(d.create("a",{href:"#",id:n,textContent:e.fileName},t).onclick=i,zipResult.append(t),t.append(d.create("span",{class:"small",textContent:e.timeLoad})),d.create("ul",{style:"display:none"}));e.fileContent.map(e=>{a.append(d.create("li",{textContent:e}))}),zipResult.append(a)},preLoadWords:function(e){bufferTable=e.raw_index,t=e.target,a(bufferTable)},getMeaning:function(e){e.append&&(meanningShow.innerHTML+=e.data),e.append||(meanningShow.innerHTML=e.data)},showStatus:function(e){dictStatus.innerText=e},percentLoad:function(e){"100%"==(d.id("myBar").style.width=e)&&(d.id("myProgress").style.display="none")},getFindWord:function(e){console.log(e)}};async function f(e){var t,n,a,r=new Uint8Array;for(t in await e){var i=e[t];i.sort();for(var s=0;s<i.length;await s++){var o=i[s],o=await fetch("/dicts/"+t+o).then(e=>e.arrayBuffer()).then(e=>e);n=r,o=o,a=void 0,(a=new Uint8Array(n.byteLength+o.byteLength)).set(new Uint8Array(n),0),a.set(new Uint8Array(o),n.byteLength),r=a}var d=new File([r],t+".zip");l.push(d)}}o.onmessage=function(t){var e=t["data"];try{s[e.fn](e.data)}catch(e){console.log(t),console.error(e)}},d.init(async()=>{searchInput.parentNode.parentNode.onsubmit=e=>(e.preventDefault(),meanningShow.innerHTML="",o.postMessage({fn:"findWord",data:searchInput.value}),!1);var s={};fetch("/stardict/listdist").then(e=>e.json()).then(async e=>{for(var t=0;t<e.length;await t++){var n=(r=e[t]).substr(0,r.length-4);".zip"!=(i=r.substr(r.length-4,r.length))&&(s[n]||(s[n]=[]),s[n].push(i))}for(t=0;t<e.length;await t++){var a,r,n=(r=e[t]).substr(0,r.length-4),i=r.substr(r.length-4,r.length);s[n]||".zip"!=i||(a=await fetch("/dicts/"+r).then(e=>e.blob()).then(e=>e),a=new File([a],r,{type:a.type}),l.push(a))}await f(s),o.postMessage({fn:"loadList",data:l})})})}();